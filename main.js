
let e=null;function t(t,n){const a=["3 BANDES","BANDA","LLIURE"],r=a.map(e=>o.filter(n=>n.Jugador===t&&n.Modalitat===e).map(e=>({any:parseInt(e.Any,10),mitjana:parseFloat(e.Mitjana)})).sort((e,t)=>e.any-t.any)),c=[...new Set(r.flat().map(e=>e.any))].sort((e,t)=>e-t),i=["blue","green","red"],l=a.map((e,t)=>({label:e,data:c.map(e=>{const n=r[t].find(t=>t.any===e);return n?Number.parseFloat(n.mitjana):null}),borderColor:i[t],backgroundColor:i[t],tension:.2,fill:!1})),s=document.getElementById("chart-canvas"),p=document.getElementById("chart-overlay");p&&(p.style.display="flex",e=document.activeElement);const m=document.getElementById("close-chart");m&&m.focus(),v();const u=document.getElementById("chart-title");u&&(u.textContent=n);const h=s.getContext("2d");d&&d.destroy(),f(new Chart(h,{type:"line",data:{labels:c,datasets:l},options:{plugins:{legend:{position:"right"}},scales:{x:{title:{display:!0,text:"Any"},ticks:{stepSize:1,autoSkip:!1}},y:{title:{display:!0,text:"Mitjana"},suggestedMin:(()=>{const e=l.flatMap(e=>e.data).filter(e=>null!=e),t=e.length?Math.min(...e):0;return Math.floor(10*(t-.1))/10})(),suggestedMax:(()=>{const e=l.flatMap(e=>e.data).filter(e=>null!=e),t=e.length?Math.max(...e):1;return Math.ceil(10*(t+.1))/10})(),ticks:{beginAtZero:!1,stepSize:.1}}},responsive:!0,maintainAspectRatio:!1}}))}function n(){const e=document.getElementById("content");e.innerHTML="";const n=document.createElement("table"),a=document.createElement("tr");["Posició","Jugador","Mitjana"].forEach(e=>{const t=document.createElement("th");t.textContent=e,a.appendChild(t)}),n.appendChild(a);o.filter(e=>parseInt(e.Any,10)===c&&e.Modalitat===i).sort((e,t)=>parseFloat(t.Mitjana)-parseFloat(e.Mitjana)).forEach((e,a)=>{const o=document.createElement("tr");["Posició","Jugador","Mitjana"].forEach(n=>{const r=document.createElement("td");let c;c="Posició"===n?a+1:"Mitjana"===n?Number.parseFloat(e[n]).toFixed(3):"Jugador"===n?e.NomComplet:e[n],r.textContent=c,"Jugador"===n&&(r.classList.add("player-cell"),r.addEventListener("click",n=>{n.stopPropagation(),t(e.Jugador,e.NomComplet)})),o.appendChild(r)}),o.addEventListener("click",()=>{t(e.Jugador,e.NomComplet)}),n.appendChild(o)}),b(e,n)}function a(){const e=document.getElementById("content");e.innerHTML="";const t=document.createElement("table"),n=document.createElement("tr");["#","Jugador","PJ","P","C","E","MG","MM"].forEach(e=>{const t=document.createElement("th");t.textContent=e,n.appendChild(t)}),t.appendChild(n);l.filter(e=>parseInt(e.Any,10)===p&&e.Modalitat===m&&e.Categoria===u).sort((e,t)=>parseInt(e.Posició,10)-parseInt(t.Posició,10)).forEach(e=>{const n=document.createElement("tr");[e["Posició"],e.Jugador||e.Nom||"",e.PartidesJugades||e["Partides jugades"]||e.PJ||"",e.Punts,e.Caramboles,e.Entrades,e.MitjanaGeneral||e.Mitjana||"",e.MitjanaParticular||e["Millor mitjana"]||""].forEach((e,t)=>{const a=document.createElement("td");if(t>=6&&""!==e){const t=Number.parseFloat(e);e=Number.isNaN(t)?e:t.toFixed(3)}a.textContent=e,n.appendChild(a)}),t.appendChild(n)}),b(e,t)}let o=[],r=[],c=null,i="3 BANDES",d=null,l=[],s=[],p=null,m="3 BANDES",u=null,h=[],g=(()=>{const e=new Date;return e.setHours(0,0,0,0),e.setDate(e.getDate()-(e.getDay()+6)%7),e})(),E={},C=null;function f(e){d=e}function b(e,t){const n=document.createElement("div");n.className="table-responsive",n.appendChild(t),e.appendChild(n)}function v(){const e=document.getElementById("player-chart");e&&(e.style.width="90vw",e.style.height="96vh");const t=document.getElementById("chart-canvas");t&&(t.style.width="100%",t.style.height="100%"),d&&d.resize()}function y(e,t){const n=document.getElementById("torneig-category-buttons");if(n.innerHTML="",!e||0===e.length)return n.style.display="none",C=null,void t();e.sort(),C&&e.includes(C)||(C=e[0]),e.forEach(e=>{const a=document.createElement("button");a.textContent=`${e}a`,e===C&&a.classList.add("selected"),a.addEventListener("click",()=>{C=e,n.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),a.classList.add("selected"),t()}),n.appendChild(a)}),n.style.display="flex",t()}function x(e,t){const n=document.getElementById("content");n.innerHTML="";const a=document.getElementById("torneig-category-buttons");if(a.style.display="none",a.innerHTML="","calendari.json"===t)return void function(e){const t=document.getElementById("content");if(t.innerHTML="",!Array.isArray(e))return void(t.textContent="Dades de calendari no vàlides.");const n=e.filter(e=>e.Data),a=e.filter(e=>!e.Data);n.sort((e,t)=>{const n=(e.Data||"").localeCompare(t.Data||"");if(0!==n)return n;const a=(e.Hora||"").localeCompare(t.Hora||"");return 0!==a?a:(parseInt((e.Billar||"").match(/\d+/),10)||0)-(parseInt((t.Billar||"").match(/\d+/),10)||0)});const o=document.createElement("div");o.id="calendari-filters";const r=document.createElement("input");r.id="calendari-player-filter",r.type="text",r.placeholder="Filtre Nom Jugador",o.appendChild(r),t.appendChild(o);const c=document.createElement("div");t.appendChild(c);const i={"01":"gen","02":"feb","03":"mar","04":"abr","05":"mai","06":"jun","07":"jul","08":"ago","09":"set",10:"oct",11:"nov",12:"des"};function d(e=""){e=(e||"").toLowerCase(),c.innerHTML="";const t=n.filter(t=>{if(!e)return!0;const n=(t["Jugador A"]||"").trim().toLowerCase(),a=(t["Jugador B"]||"").trim().toLowerCase();return n.includes(e)||a.includes(e)}),o=t.reduce((e,t)=>(e[t.Data]=(e[t.Data]||0)+1,e),{}),r=document.createElement("table"),d=document.createElement("tr");["Data","Hora","Billar","Jugador A","Jugador B"].forEach(e=>{const t=document.createElement("th");t.textContent=e,d.appendChild(t)}),r.appendChild(d);let l=null;t.forEach(e=>{const t=document.createElement("tr");if(e.Data!==l){const n=document.createElement("td"),[a,r,c]=(e.Data||"").split("-"),d=parseInt(c,10),s=r&&d?`${d}<br>${i[r]||r}`:"";n.innerHTML=s;const p=o[e.Data];p>1&&(n.rowSpan=p,n.classList.add("vertical-text")),t.appendChild(n),l=e.Data}const n=(e.Billar||"").replace("Billar ","B");let a=e.Hora||"";/^\d{1,2}:00$/.test(a)&&(a=a.split(":")[0]),[a,n,(e["Jugador A"]||"").trim(),(e["Jugador B"]||"").trim()].forEach(e=>{const n=document.createElement("td");n.textContent=e,t.appendChild(n)}),r.appendChild(t)}),b(c,r);const s=a.filter(t=>{if(!e)return!0;const n=(t["Jugador A"]||"").trim().toLowerCase(),a=(t["Jugador B"]||"").trim().toLowerCase();return n.includes(e)||a.includes(e)}).sort((e,t)=>(parseInt(e.Jornada,10)||0)-(parseInt(t.Jornada,10)||0));if(s.length>0){const e=document.createElement("h3");e.textContent="Pendent de programar",c.appendChild(e);const t=document.createElement("table"),n=document.createElement("tr");["Jornada","J1","J2"].forEach(e=>{const t=document.createElement("th");t.textContent=e,n.appendChild(t)}),t.appendChild(n),s.forEach(e=>{const n=document.createElement("tr");[e.Jornada||"",(e["Jugador A"]||"").trim(),(e["Jugador B"]||"").trim()].forEach(e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)}),t.appendChild(n)}),b(c,t)}}r.addEventListener("input",()=>{d(r.value.trim().toLowerCase())}),d()}(e);if("partides.json"===t){return void y([...new Set(e.map(e=>e["🏆 Categoria de la partida"]))],()=>function(e){const t=document.getElementById("content");if(t.innerHTML="",!Array.isArray(e))return void(t.textContent="Dades de partides no vàlides.");e.sort((e,t)=>{const n=new Date(e.Timestamp);return new Date(t.Timestamp)-n});const n=document.createElement("div");n.id="partides-filters";const a=document.createElement("input");a.id="partides-player-filter",a.type="text",a.placeholder="Filtre Nom Jugador",n.appendChild(a),t.appendChild(n);const o=document.createElement("div");function r(t=""){t=(t||"").toLowerCase(),o.innerHTML="",e.filter(e=>e["🏆 Categoria de la partida"]===C).filter(e=>{if(!t)return!0;const n=(e["🎱 Nom del Jugador 1"]||"").trim().toLowerCase(),a=(e["🎱 Nom del Jugador 2"]||"").trim().toLowerCase();return n.includes(t)||a.includes(t)}).forEach((e,t)=>{const n=(e["🎱 Nom del Jugador 1"]||"").trim(),a=(e["🎱 Nom del Jugador 2"]||"").trim(),r=parseInt(e["🔢 Caramboles del Jugador 1"],10)||0,c=parseInt(e["🔢 Caramboles del Jugador 2"],10)||0,i=e["⏱️ Entrades de la partida"]||"",d=(parseFloat(e["Mitjana J1"])||0).toFixed(3),l=(parseFloat(e["Mitjana J2"])||0).toFixed(3),s=r>c?" 🏆":"",p=c>r?" 🏆":"",m=document.createElement("table");m.className="partida";const u=document.createElement("colgroup");if(["jugadors","c","e","m"].forEach(e=>{const t=document.createElement("col");t.className=e,u.appendChild(t)}),m.appendChild(u),0===t){const e=document.createElement("thead"),t=document.createElement("tr");["Jugadors","C","E","M"].forEach(e=>{const n=document.createElement("th");n.textContent=e,t.appendChild(n)}),e.appendChild(t),m.appendChild(e)}const h=document.createElement("tbody"),g=document.createElement("tr"),E=document.createElement("tr"),C=document.createElement("td");C.textContent=`${n}${s}`;const f=document.createElement("td");f.textContent=r;const v=document.createElement("td");v.textContent=i,v.rowSpan=2;const y=document.createElement("td");y.textContent=d,g.appendChild(C),g.appendChild(f),g.appendChild(v),g.appendChild(y);const x=document.createElement("td");x.textContent=`${a}${p}`;const L=document.createElement("td");L.textContent=c;const j=document.createElement("td");j.textContent=l,E.appendChild(x),E.appendChild(L),E.appendChild(j),h.appendChild(g),h.appendChild(E),m.appendChild(h),b(o,m)})}t.appendChild(o),a.addEventListener("input",()=>{r(a.value.trim().toLowerCase())}),r()}(e))}if(!e)return;if(Array.isArray(e)&&0===e.length){const e=document.createElement("p");return e.textContent="No hi ha dades.",void n.appendChild(e)}if("classificacio.json"!==t&&Array.isArray(e)&&e[0]&&("Categoria jugador"in e[0]&&"Nom jugador"in e[0]||"Categoria"in e[0]&&"Nom"in e[0])){const t="Categoria jugador"in e[0]?"Categoria jugador":"Categoria",a="Nom jugador"in e[0]?"Nom jugador":"Nom",o=e.reduce((e,n)=>{const o=n[t];return e[o]||(e[o]=[]),e[o].push((n[a]||"").trim()),e},{});return void y(Object.keys(o),()=>{n.innerHTML="";const e=C,t=document.createElement("h3"),a=E[e];t.textContent=a?`${e}a categoria (${a} caramboles)`:`${e}a categoria`,n.appendChild(t);const r=document.createElement("ul");(o[e]||[]).forEach(e=>{const t=document.createElement("li");t.textContent=e,r.appendChild(t)}),n.appendChild(r)})}if("classificacio.json"===t&&Array.isArray(e)&&e[0]&&"Posició"in e[0]){const t=e.reduce((e,t)=>{const n=t.Categoria||"";return e[n]||(e[n]=[]),e[n].push(t),e},{});return void y(Object.keys(t),()=>{n.innerHTML="";const e=C,a=document.createElement("h3"),o=E[e];a.textContent=o?`${e}a categoria (${o} caramboles)`:`${e}a categoria`,n.appendChild(a);const r=document.createElement("table"),c=document.createElement("tr");["#","Jugador","PJ","P","C","E","MG","MM"].forEach(e=>{const t=document.createElement("th");t.textContent=e,c.appendChild(t)}),r.appendChild(c),(t[e]||[]).sort((e,t)=>{const n=parseInt(e.Punts,10)||0,a=parseInt(t.Punts,10)||0;if(a!==n)return a-n;const o=parseFloat(e.MitjanaGeneral||e.Mitjana||"0");return parseFloat(t.MitjanaGeneral||t.Mitjana||"0")-o}).forEach((e,t)=>{const n=document.createElement("tr");[t+1,e.Nom||"",e.PartidesJugades||e["Partides jugades"]||e.PJ||"",e.Punts,e.Caramboles,e.Entrades,e.MitjanaGeneral||e.Mitjana||"",e.MitjanaParticular||e["Millor mitjana"]||""].forEach((e,t)=>{const a=document.createElement("td");if(t>=6&&""!==e){const t=Number.parseFloat(e);e=Number.isNaN(t)?e:t.toFixed(3)}a.textContent=e,n.appendChild(a)}),r.appendChild(n)}),b(n,r)})}if(Array.isArray(e)&&e[0]&&"Categoria"in e[0]){const t=e.reduce((e,t)=>{const n=t.Categoria||"";return e[n]||(e[n]=[]),e[n].push(t),e},{}),a=Object.keys(e[0]).filter(e=>"Categoria"!==e);return void y(Object.keys(t),()=>{n.innerHTML="";const e=C,o=document.createElement("h3"),r=E[e];o.textContent=r?`${e}a categoria (${r} caramboles)`:`${e}a categoria`,n.appendChild(o);const c=document.createElement("table"),i=document.createElement("tr");a.forEach(e=>{const t=document.createElement("th");t.textContent=e,i.appendChild(t)}),c.appendChild(i),(t[e]||[]).forEach(e=>{const t=document.createElement("tr");a.forEach(n=>{const a=document.createElement("td");a.textContent=e[n]||"",t.appendChild(a)}),c.appendChild(t)}),b(n,c)})}if(Array.isArray(e)&&Array.isArray(e[0])){const t=e[0],a=document.createElement("table"),o=document.createElement("tr");return t.forEach(e=>{const t=document.createElement("th");t.textContent=e,o.appendChild(t)}),a.appendChild(o),e.slice(1).forEach(e=>{const n=document.createElement("tr");t.forEach((t,a)=>{const o=document.createElement("td");o.textContent=e[a]||"",n.appendChild(o)}),a.appendChild(n)}),void b(n,a)}if(Array.isArray(e)&&"object"==typeof e[0]){const t=[...new Set(e.flatMap(e=>Object.keys(e)))],a=document.createElement("table"),o=document.createElement("tr");return t.forEach(e=>{const t=document.createElement("th");t.textContent=e,o.appendChild(t)}),a.appendChild(o),e.forEach(e=>{const n=document.createElement("tr");t.forEach(t=>{const a=document.createElement("td");a.textContent=e[t]||"",n.appendChild(a)}),a.appendChild(n)}),void b(n,a)}const o=document.createElement("pre");o.textContent=JSON.stringify(e,null,2),n.appendChild(o)}const L=["filters-row","classificacio-filters","torneig-buttons","torneig-title","torneig-category-buttons","continu3b-buttons","content"];function j(){L.forEach(e=>{const t=document.getElementById(e);t&&(t.style.display="none")})}const D={"btn-ranking":{show:[{id:"filters-row",display:"flex"}],action:n},"btn-classificacio":{show:[{id:"classificacio-filters",display:"flex"}],action:a},"btn-agenda":{action:function(){const e=document.getElementById("content");e.innerHTML="";const t=document.createElement("div");t.id="calendar-container";const n=document.createElement("div");n.className="calendar-nav";const a=document.createElement("button");a.textContent="<";const o=document.createElement("button");o.textContent=">";const r=document.createElement("span");r.id="calendar-month",a.addEventListener("click",()=>{g.setDate(g.getDate()-7),m()}),o.addEventListener("click",()=>{g.setDate(g.getDate()+7),m()}),n.appendChild(a),n.appendChild(r),n.appendChild(o),t.appendChild(n);const c=document.createElement("table");c.className="calendar-table";const i=document.createElement("tr");["Dl","Dt","Dc","Dj","Dv","Ds","Dg"].forEach(e=>{const t=document.createElement("th");t.textContent=e,i.appendChild(t)}),c.appendChild(i);const d=document.createElement("tbody");c.appendChild(d),b(t,c),e.appendChild(t);const l=document.createElement("table");l.id="event-list",l.classList.add("agenda-table"),b(e,l);const s=new Date;let p=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())).toISOString().split("T")[0];function m(){const e=new Date(g);e.setDate(g.getDate()+6);const t=new Date(g);t.setDate(g.getDate()+7),(new Date(p)<g||new Date(p)>=t)&&(p=g.toISOString().split("T")[0]);const n=g.toLocaleDateString("ca-ES",{day:"numeric",month:"short"}),a=e.toLocaleDateString("ca-ES",{day:"numeric",month:"short",year:"numeric"});r.textContent=`${n} - ${a}`,function(){d.innerHTML="";const e=document.createElement("tr");for(let t=0;t<7;t++){const n=document.createElement("td"),a=new Date(g);a.setDate(g.getDate()+t);const o=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate())).toISOString().split("T")[0];n.textContent=a.getDate(),n.dataset.date=o;const r=h.filter(e=>e.Data===o);if(r.length>0){let e="event-other";r.some(e=>"festiu"===e.Tipus)?e="event-festiu":r.some(e=>"assemblea"===e.Tipus)?e="event-assemblea":r.some(e=>"partida"===e.Tipus)?e="event-partida":r.some(e=>e["Títol"].includes("Fi"))?e="event-fi":r.some(e=>e["Títol"].includes("Inici"))&&(e="event-inici"),n.classList.add(e)}o===p&&n.classList.add("selected-day"),n.addEventListener("click",()=>{p=o,m()}),e.appendChild(n)}d.appendChild(e)}(),function(){l.innerHTML="";const e=document.createElement("tr");["Data","Títol"].forEach(t=>{const n=document.createElement("th");n.textContent=t,e.appendChild(n)}),l.appendChild(e),h.filter(e=>e.Data===p).sort((e,t)=>(e.Hora||"").localeCompare(t.Hora||"")).forEach(e=>{const t=document.createElement("tr");t.dataset.date=e.Data;let n="event-other";"festiu"===e.Tipus?n="event-festiu":"assemblea"===e.Tipus?n="event-assemblea":"partida"===e.Tipus?n="event-partida":e["Títol"].includes("Fi")?n="event-fi":e["Títol"].includes("Inici")&&(n="event-inici"),t.classList.add(n),["Data","Títol"].forEach(n=>{const a=document.createElement("td");if("Data"===n){const[t,n,o]=(e.Data||"").split("-");a.textContent=`${o}/${n}`}else a.textContent=e[n]||"";t.appendChild(a)}),l.appendChild(t)})}()}m()}},"btn-horari":{action:function(){document.getElementById("content").innerHTML='\n<div class="normes-container">\n  <h2 class="normes-title">Normes d’ús i horari</h2>\n\n  \x3c!-- Horari --\x3e\n  <div class="normes-card horari">\n    <h3>🕒 Horari d\'obertura de la Secció</h3>\n    <ul>\n      <li><b>Dilluns, dimecres, dijous, dissabte i diumenge:</b> 9:00 – 21:30</li>\n      <li><b>Dimarts i divendres:</b> 10:30 – 21:30</li>\n      <li>L\'horari d\'obertura pot canviar en funció dels horaris d\'obertura del <b>Bar del Foment</b>.</li>\n      <li>L\'horari d\'atenció al públic del <b>FOMENT</b> és de <b>DILLUNS A DIVENDRES</b> de <b>9:00 A 13:00</b> i de <b>16:00 A 20:00</b>.</li>\n      <li>Les seccions poden tenir activitat fora d\'aquest horari si el bar està obert, excepte <b>AGOST</b> i <b>FESTIUS</b>, quan el <b>FOMENT</b> resta oficialment tancat.</li>\n      <li>La secció romandrà tancada els dies de <b>TANCAMENT OFICIAL</b> del <b>FOMENT</b>.</li>\n\n    </ul>\n  </div>\n\n  \x3c!-- Norma Obligatòria --\x3e\n  <div class="normes-card obligatori">\n    <h3>🚨 OBLIGATORI</h3>\n    <p class="obligatori-text">\n      Netejar el billar i les boles abans de començar cada partida amb el material que la Secció posa a disposició de tots els socis.\n    </p>\n  </div>\n\n  \x3c!-- Prohibicions --\x3e\n  <div class="normes-card prohibit">\n\n    <h3>🚫 PROHIBIT</h3>\n\n    <ul>\n      <li>Jugar a fantasia.</li>\n      <li>Menjar mentre s\'està jugant.</li>\n      <li>Posar begudes sobre cap element del billar.</li>\n    </ul>\n  </div>\n\n  \x3c!-- Inscripció --\x3e\n  <div class="normes-card">\n    <h3>📝 Inscripció a les partides</h3>\n    <ul>\n      <li>Apunta’t a la pissarra única de <b>PARTIDES SOCIALS</b>.</li>\n      <li>Els companys no cal que s’apuntin; si ho fan, que sigui al costat del primer jugador.</li>\n    </ul>\n  </div>\n\n  \x3c!-- Assignació de taula --\x3e\n  <div class="normes-card">\n    <h3>🗂 Assignació de taula</h3>\n    <ul>\n      <li>Quan hi hagi una taula lliure, ratlla el teu nom i juga.</li>\n      <li>Si vols una taula concreta ocupada, <b>passa el torn</b> fins que s’alliberi.</li>\n    </ul>\n  </div>\n\n  \x3c!-- Temps de joc --\x3e\n  <div class="normes-card">\n    <h3>⏳ Temps de joc</h3>\n    <ul>\n      <li>Màxim <b>1 hora</b> per partida (sol o en grup).</li>\n      <li><b>PROHIBIT</b> posar monedes per allargar el temps, encara que hi hagi taules lliures.</li>\n    </ul>\n  </div>\n\n  \x3c!-- Tornar a jugar --\x3e\n  <div class="normes-card">\n    <h3>🔄 Tornar a jugar</h3>\n    <ul>\n      <li>Només pots repetir si <b>no hi ha ningú apuntat</b> i hi ha una taula lliure.</li>\n    </ul>\n  </div>\n</div>\n  '}},"btn-enllacos":{action:function(){const e=document.getElementById("content");e.innerHTML="",fetch("data/enllacos.json").then(e=>e.json()).then(t=>{const n={};t.forEach(e=>{const t=e.Tipus||"Altres";n[t]||(n[t]=[]),n[t].push(e)}),Object.entries(n).forEach(([t,n])=>{const a=document.createElement("details"),o=document.createElement("summary");o.textContent=t,o.classList.add("enllac-tipus"),a.appendChild(o),n.forEach(e=>{const t=e.URL||e.Url||e.url;if(t){const n=a.querySelector("ul")||document.createElement("ul"),o=document.createElement("li"),r=document.createElement("a");r.href=t,r.target="_blank",r.rel="noopener";let c=e.Títol||e.Titol||e.Nom||e.Name||e.Text||t;e.Billar&&(c+=` - Billar ${e.Billar}`),r.textContent=c,o.appendChild(r),n.appendChild(o),a.appendChild(n)}}),e.appendChild(a)})}).catch(t=>{e.textContent="No s'han pogut carregar els enllaços.",console.error("Error loading links",t)})}},"btn-continu3b":{show:[{id:"continu3b-buttons",display:"flex"}],action:function(){const e=document.getElementById("content");e.innerHTML="";const t=document.getElementById("continu3b-buttons");t.innerHTML="",Promise.all([fetch("data/continu3b_rankingactiu.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_llistaespera.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_reptes.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_partides.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_jugadors.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_parametres.json").then(e=>e.json()).catch(()=>[])]).then(([n,a,o,r,c,i])=>{const d=Object.fromEntries(c.map(e=>[e.id,e.nom])),l=parseInt((i.find(e=>"COOLDOWN_REPTAR_DIES"===e.clau)||{}).valor,10)||7;const s=(n,a)=>{t.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),n.classList.add("selected"),e.innerHTML="",a()},p=document.createElement("label");p.id="ranking-filter-disponibles";const m=document.createElement("input");m.type="checkbox",p.appendChild(m),p.appendChild(document.createTextNode(" Mostra només disponibles"));const u=document.createElement("button");u.textContent="Rànquing actual",m.addEventListener("change",()=>u.click()),u.addEventListener("click",()=>s(u,()=>{const t=document.createElement("h3");if(t.textContent="Rànquing actual",e.appendChild(t),Array.isArray(n)&&n.length){const t=document.createElement("table");t.classList.add("ranking-table");const a=document.createElement("thead"),i=document.createElement("tr");["Posició","Jugador","Dies per reptar/ser reptat","Disponible"].forEach(e=>{const t=document.createElement("th");t.textContent=e,i.appendChild(t)}),a.appendChild(i),t.appendChild(a);const s=document.createElement("tbody");n.slice().sort((e,t)=>parseInt(e.posicio)-parseInt(t.posicio)).forEach(t=>{const n=c.find(e=>e.id===t.jugador_id),{dies:a,data:i}=(e=>{if(!e)return{dies:null,data:""};const[t,n,a]=e.split("/"),o=new Date(`${a}-${n}-${t}T00:00:00`);return isNaN(o)?{dies:null,data:""}:{dies:Math.floor((Date.now()-o.getTime())/864e5),data:`${t}/${n}/${a}`}})(n?n.data_ultim_repte:""),p=o.find(e=>(e.reptador_id===t.jugador_id||e.reptat_id===t.jugador_id)&&["proposat","acceptat","programat"].includes(e.estat)),h=((e,t,n,a)=>{if(1===parseInt(n,10))return!1;if(a){if(a.data_programa)return!1;{let e=0,t="";if("proposat"===a.estat?(e=14,t=a.created_at):"acceptat"===a.estat&&(e=7,t=a.data_acceptacio||a.created_at),!e)return!1;if(Math.floor((Date.now()-new Date(t).getTime())/864e5)<e)return!1}}return null==t||t>=l})(t.jugador_id,a,t.posicio,p);if(m.checked&&!h)return;const g=document.createElement("tr"),E=document.createElement("td");E.textContent=t.posicio,g.appendChild(E);const C=d[t.jugador_id]||t.jugador_id,f=document.createElement("button");f.textContent=C,f.addEventListener("click",()=>function(t,n){e.innerHTML="";const a=document.createElement("h3");a.textContent=`Partides de ${n}`,e.appendChild(a);const o=r.filter(e=>e.local_id===t||e.visitant_id===t);if(o.length){const n=document.createElement("table"),a=document.createElement("thead"),r=document.createElement("tr");["Data","Rival","Resultat"].forEach(e=>{const t=document.createElement("th");t.textContent=e,r.appendChild(t)}),a.appendChild(r),n.appendChild(a);const c=document.createElement("tbody");o.forEach(e=>{const n=document.createElement("tr"),a=e.data?new Date(e.data).toLocaleDateString("ca-ES"):"",o=e.local_id===t,r=o?e.visitant_id:e.local_id;[a,d[r]||r,e.caramboles_local&&e.caramboles_visitant?o?`${e.caramboles_local}-${e.caramboles_visitant}`:`${e.caramboles_visitant}-${e.caramboles_local}`:""].forEach(e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)}),c.appendChild(n)}),n.appendChild(c),b(e,n)}else{const t=document.createElement("p");t.textContent="No hi ha partides per aquest jugador.",e.appendChild(t)}const c=document.createElement("button");c.textContent="Torna",c.addEventListener("click",()=>u.click()),e.appendChild(c)}(t.jugador_id,C));const v=document.createElement("td");v.appendChild(f),g.appendChild(v);const y=document.createElement("td");let x=0;if(p&&!p.data_programa){let e=0,t="";if("proposat"===p.estat?(e=7,t=p.created_at):"acceptat"===p.estat&&(e=7,t=p.data_acceptacio||p.created_at),e){const n=Math.floor((Date.now()-new Date(t).getTime())/864e5);x=Math.max(e-n,0)}}else null!=a&&(x=Math.max(l-a,0),i&&(y.title=`Últim repte: ${i}`));y.textContent=`${x} dies`,g.appendChild(y);const L=document.createElement("span");L.textContent=h?"🟢":"🔴",L.title=h?"Pot reptar i ser reptat":"No pot reptar ni ser reptat";const j=document.createElement("td");j.appendChild(L),g.appendChild(j),s.appendChild(g)}),t.appendChild(s);const h=document.createElement("div");["🟢 Pot reptar i ser reptat","🔴 No pot reptar ni ser reptat"].forEach(e=>{const t=document.createElement("p");t.textContent=e,h.appendChild(t)}),e.appendChild(h),e.appendChild(p),b(e,t)}else{const t=document.createElement("p");t.textContent="No hi ha rànquing disponible.",e.appendChild(t)}}));const h=document.createElement("button");h.textContent="Reptes",h.addEventListener("click",()=>s(h,()=>{const t=o.filter(e=>"proposat"===e.estat&&"acces"!==e.tipus),n=o.filter(e=>"acceptat"===e.estat&&"acces"!==e.tipus),a=o.filter(e=>"programat"===e.estat&&"acces"!==e.tipus),c=o.filter(e=>"tancat"===e.estat&&"acces"!==e.tipus),i=document.createElement("h3");i.textContent="Reptes",e.appendChild(i);const l=(t,n,a=e)=>{t.forEach(e=>{const t=document.createElement("div");t.classList.add("repte-card");const o=d[e.reptador_id]||e.reptador_id,r=d[e.reptat_id]||e.reptat_id,c=document.createElement("h4");c.textContent=`${o} vs ${r}`,t.appendChild(c);n(e).forEach(([e,n])=>{if(n){const a=document.createElement("p");a.textContent=`${e}: ${new Date(n).toLocaleDateString("ca-ES")}`,t.appendChild(a)}}),a.appendChild(t)})},s=(t,n,a,o)=>{const r=document.createElement("h4");if(r.textContent=t,e.appendChild(r),n.length)l(n,a);else{const t=document.createElement("p");t.textContent=o,e.appendChild(t)}},p=e=>e?new Date(new Date(e).getTime()+6048e5):null,m=Object.fromEntries(r.map(e=>[e.id,e])),u=e=>{const t=m[e.partida_id]||{};return[["Creació",e.created_at],["Acceptació",e.data_acceptacio],["Programació",e.data_programa],["Jugat",t.data]]};s("Pendents d’acceptar",t,e=>{const t=p(e.created_at),n=p(t);return[["Creació",e.created_at],["Límit acceptar",t],["Límit jugar",n]]},"No hi ha reptes pendents."),s("Acceptats",n,e=>[["Creació",e.created_at],["Acceptació",e.data_acceptacio],["Límit jugar",p(e.data_acceptacio||e.created_at)]],"No hi ha reptes acceptats."),s("Programats",a,e=>[["Creació",e.created_at],["Acceptació",e.data_acceptacio],["Programació",e.data_programa],["Límit jugar",p(e.data_acceptacio||e.created_at)]],"No hi ha reptes programats.");const h=document.createElement("details");h.id="reptes-tancats";const g=document.createElement("summary");if(g.textContent="Tancats",h.appendChild(g),c.length)l(c,u,h);else{const e=document.createElement("p");e.textContent="No hi ha reptes tancats.",h.appendChild(e)}e.appendChild(h)}));const g=document.createElement("button");g.textContent="Llista d'espera",g.addEventListener("click",()=>s(g,()=>{const t=document.createElement("h3");if(t.textContent="Llista d'espera",e.appendChild(t),Array.isArray(a)&&a.length){const t=document.createElement("div");a.slice().sort((e,t)=>parseInt(e.ordre,10)-parseInt(t.ordre,10)).forEach(e=>{const n=document.createElement("button"),a=d[e.jugador_id]||e.jugador_id;n.textContent=`${e.ordre}. ${a}`,n.addEventListener("click",()=>mostraEvolucioJugador(e.jugador_id,a)),t.appendChild(n)}),e.appendChild(t)}else{const t=document.createElement("p");t.textContent="No hi ha jugadors en llista d'espera.",e.appendChild(t)}}));const E=document.createElement("button");E.textContent="Reptes accés",E.addEventListener("click",()=>s(E,()=>{const t=document.createElement("h3");t.textContent="Reptes accés",e.appendChild(t);const n=o.filter(e=>"tancat"!==e.estat&&"acces"===e.tipus),a=document.createElement("h4");if(a.textContent="Reptes",e.appendChild(a),n.length){const t=document.createElement("table"),a=document.createElement("thead"),o=document.createElement("tr");["Reptador","Reptat","Creació","Acceptació","Programació","Límit"].forEach(e=>{const t=document.createElement("th");t.textContent=e,o.appendChild(t)}),a.appendChild(o),t.appendChild(a);const r=document.createElement("tbody");n.forEach(e=>{const t=document.createElement("tr");[d[e.reptador_id]||e.reptador_id,d[e.reptat_id]||e.reptat_id,e.created_at?new Date(e.created_at).toLocaleDateString("ca-ES"):"",e.data_acceptacio?new Date(e.data_acceptacio).toLocaleDateString("ca-ES"):"",e.data_programa?new Date(e.data_programa).toLocaleDateString("ca-ES"):"",e.deadline_jugar?new Date(e.deadline_jugar).toLocaleDateString("ca-ES"):""].forEach(e=>{const n=document.createElement("td");n.textContent=e,t.appendChild(n)}),r.appendChild(t)}),t.appendChild(r),b(e,t)}else{const t=document.createElement("p");t.textContent="No hi ha reptes d'accés pendents.",e.appendChild(t)}}));const C=document.createElement("button");C.textContent="Partides",C.addEventListener("click",()=>s(C,()=>{const t=document.createElement("h3");if(t.textContent="Partides",e.appendChild(t),Array.isArray(r)&&r.length){const t=Object.fromEntries(n.map(e=>[e.jugador_id,parseInt(e.posicio,10)]));r.slice().sort((e,t)=>new Date(t.data)-new Date(e.data)).forEach(n=>{const a=document.createElement("div");a.classList.add("partida-card");const r=o.find(e=>e.id===n.repte_id)||{},c=d[n.local_id]||n.local_id,i=d[n.visitant_id]||n.visitant_id,l=n.caramboles_local&&n.caramboles_visitant?`${n.caramboles_local}-${n.caramboles_visitant}`:"",s=t[n.local_id],p=t[n.visitant_id],m="TRUE"===r.resultat_guanya_reptador;let u=s,h=p;m&&void 0!==s&&void 0!==p&&(u=p,h=s);const g=void 0!==u?u:"-",E=void 0!==h?h:"-",C=m?"Intercanvi de posicions":"No intercanvi de posicions",f=n.data?new Date(n.data).toLocaleDateString("ca-ES"):"";a.innerHTML=`\n                <h4>${f}</h4>\n                <p>${c} (Pos. ${g}) vs ${i} (Pos. ${E})</p>\n                <p>Resultat: ${l}</p>\n                <p>${C}</p>\n              `,e.appendChild(a)})}else{const t=document.createElement("p");t.textContent="No hi ha partides registrades.",e.appendChild(t)}}));const f=document.createElement("button");f.textContent="Normativa",f.addEventListener("click",()=>s(f,()=>{e.innerHTML='\n<div class="normes-container">\n  <h2 class="normes-title">Normativa Continu 3B</h2>\n\n  <div class="normes-card">\n    <h3>📊 Rànquing actiu</h3>\n    <ul>\n      <li><strong>Màxim 20 jugadors</strong>, actualitzat contínuament mitjançant reptes directes</li>\n      <li>Els jugadors que vulguin formar part del rànquing un cop s\'arribi al màxim de 20 jugadors formaran part de la <strong>llista d\'espera</strong>.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <h3>⚔️ Reptes normals</h3>\n    <ul>\n      <li>Pots reptar fins a <strong>2 posicions</strong> per sobre teu.</li>\n      <li><strong>Màxim un repte actiu</strong> per jugador.</li>\n      <li><strong>Mínim 7 dies</strong> entre reptes.</li>\n      <li>Si guanya el reptador → <strong>intercanvi de posicions</strong>.</li>\n      <li>Si perd el reptador → <strong>no hi ha canvis</strong>.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <h3>🚪 Reptes d’accés</h3>\n    <ul>\n      <li><strong>Primer de la llista d’espera</strong> pot reptar el jugador 20.</li>\n      <li>Si guanya → <strong>entra al rànquing</strong> (pos. 20) i el perdedor passa a la llista d’espera.</li>\n      <li>Si perd → passa al final de la <strong>llista d’espera</strong>.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <h3>⏱️ Terminis</h3>\n    <p><strong>7 dies</strong> per acceptar un repte i <strong>7 dies</strong> per jugar-lo un cop acceptat.</p>\n  </div>\n\n  <div class="normes-card">\n    <h3>⚠️ Penalitzacions</h3>\n    <ul>\n      <li>Incompareixença o refús sense motiu → <strong>derrota automàtica</strong>.</li>\n      <li>Sense acord de data → tots dos <strong>perden una posició</strong>.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <h3>😴 Inactivitat</h3>\n    <ul>\n      <li><strong>3 setmanes</strong> sense reptes → baixa 5 posicions (pre-inactiu).</li>\n      <li><strong>6 setmanes</strong> sense reptes → surt del rànquing i entra el primer de la llista d’espera.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <p>Consulta la <a href="https://docs.google.com/document/d/165_bh9m0WxRU_LoTt_k8aiJseZZn9bBZ/edit?usp=sharing&amp;ouid=102336298592739127647&amp;rtpof=true&amp;sd=true" target="_blank" rel="noopener"><strong>normativa completa</strong></a>.</p>\n  </div>\n</div>'})),[u,h,g,E,C,f].forEach(e=>t.appendChild(e)),u.click()}).catch(t=>{console.error("Error carregant dades continu 3B",t),e.innerHTML="<p>Error carregant dades.</p>"})}},"btn-torneig":{show:[{id:"torneig-buttons",display:"flex"}],action:function(){document.getElementById("content").innerHTML="",fetch("data/modalitat.json").then(e=>e.json()).then(e=>{const t=document.getElementById("torneig-title"),n=Array.isArray(e)?e.map(e=>e.Modalitat).join(", "):e.Modalitat||"";t.textContent=`Social Modalitat ${n}`,t.style.display="block"}).catch(()=>{document.getElementById("torneig-title").style.display="none"})}}};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./service-worker.js").then(e=>{console.log("SW registrat!",e);const t=()=>{e.update().then(()=>{e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"})})};t(),setInterval(t,864e5)}).catch(e=>console.error("Error al registrar el SW:",e));let e=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{e||(window.location.reload(),e=!0)})}),document.getElementById("btn-update").addEventListener("click",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(e=>{e&&e.update().then(()=>{e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"})})})}),document.getElementById("menu").addEventListener("click",e=>{if(e.target.classList.contains("menu-toggle")){const t=document.getElementById(e.target.dataset.target),n="flex"===t.style.display;document.querySelectorAll(".submenu").forEach(e=>e.style.display="none"),t.style.display=n?"none":"flex",j()}}),document.getElementById("submenu-container").addEventListener("click",e=>{const t=D[e.target.id];t&&function(e){j(),document.getElementById("content").style.display="block",(e.show||[]).forEach(({id:e,display:t})=>{const n=document.getElementById(e);n&&(n.style.display=t)}),e.action&&e.action()}(t)}),document.getElementById("torneig-buttons").addEventListener("click",e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.file;fetch(`data/${t}`).then(e=>e.json()).then(e=>x(e,t)).catch(()=>{document.getElementById("content").innerHTML="<p>Error carregant dades.</p>"})}}),document.getElementById("close-chart").addEventListener("click",function(){document.getElementById("chart-overlay").style.display="none";const t=document.getElementById("chart-title");t&&(t.textContent=""),d&&(d.destroy(),f(null)),e&&(e.focus(),e=null)}),window.addEventListener("resize",function(){const e=document.getElementById("chart-overlay");e&&"none"!==e.style.display&&v()}),Promise.all([fetch("data/ranquing.json").then(e=>e.json()),fetch("data/classificacions.json").then(e=>e.json()).catch(()=>[]),fetch("data/events.json").then(e=>e.json()).catch(()=>[]),fetch("data/calendari.json").then(e=>e.json()).catch(()=>[]),fetch("data/festius.json").then(e=>e.json()).catch(()=>[])]).then(([e,t,d,g,E])=>{o=e,r=[...new Set(e.map(e=>parseInt(e.Any,10)))].sort((e,t)=>e-t),c=r[r.length-1],l=t,s=[...new Set(t.map(e=>parseInt(e.Any,10)))].sort((e,t)=>e-t),p=s[s.length-1]||null;const C=new Set(t.map(e=>e.Categoria));u=C.values().next().value||null,h=d.map(e=>{const t=e["Títol"]||e.Titol||"";return{...e,"Títol":t,Tipus:t.toLowerCase().includes("assemblea")?"assemblea":"altre"}}).concat(g.map(e=>({Data:e.Data,Hora:"","Títol":`${e["Jugador A"].trim()} vs ${e["Jugador B"].trim()} (${e.Hora})`,Tipus:"partida"}))).concat(E.map(e=>({Data:e.Data,Hora:"","Títol":`Foment tancat (${e.Títol||""})`,Tipus:"festiu"}))),function(){const e=document.getElementById("year-select");e.innerHTML="",r.slice().sort((e,t)=>t-e).forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,t===c&&(n.selected=!0),e.appendChild(n)}),e.addEventListener("change",()=>{c=parseInt(e.value,10),n()});const t=document.getElementById("modalitat-buttons");t.querySelectorAll("button").forEach(e=>{e.dataset.mod===i&&e.classList.add("selected"),e.addEventListener("click",()=>{i=e.dataset.mod,t.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),n()})})}(),function(){const e=document.getElementById("classificacio-year-select");e.innerHTML="",s.slice().sort((e,t)=>t-e).forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,t===p&&(n.selected=!0),e.appendChild(n)}),e.addEventListener("change",()=>{p=parseInt(e.value,10),a()});const t=document.getElementById("classificacio-modalitat-buttons");t.querySelectorAll("button").forEach(e=>{e.dataset.mod===m&&e.classList.add("selected"),e.addEventListener("click",()=>{m=e.dataset.mod,t.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),a()})});const n=document.getElementById("categoria-buttons");n.innerHTML="",[...new Set(l.map(e=>e.Categoria))].sort().forEach(e=>{const t=document.createElement("button");t.textContent=e,e===u&&t.classList.add("selected"),t.addEventListener("click",()=>{u=e,n.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),a()}),n.appendChild(t)})}(),document.getElementById("btn-agenda").click()}).catch(e=>{console.error("Error carregant dades",e)});

//# sourceMappingURL=main.js.map
