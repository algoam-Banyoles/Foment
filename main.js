const e={ranquing:[],anys:[],anySeleccionat:null,modalitatSeleccionada:"3 BANDES",lineChart:null,classificacions:[],classYears:[],classAnySeleccionat:null,classModalitatSeleccionada:"3 BANDES",classCategoriaSeleccionada:null,events:[],agendaSetmanaInici:(()=>{const e=new Date;return e.setHours(0,0,0,0),e.setDate(e.getDate()-(e.getDay()+6)%7),e})(),torneigCaramboles:{},torneigCategoriaSeleccionada:null};function t(t){e.lineChart=t}function n(e,t){const n=document.createElement("div");n.className="table-responsive",n.appendChild(t),e.appendChild(n)}function a(){const t=document.getElementById("player-chart");t&&(t.style.width="90vw",t.style.height="96vh");const n=document.getElementById("chart-canvas");n&&(n.style.width="100%",n.style.height="100%"),e.lineChart&&e.lineChart.resize()}let o=null;function c(n,c){const r=["3 BANDES","BANDA","LLIURE"],i=r.map(t=>e.ranquing.filter(e=>e.Jugador===n&&e.Modalitat===t).map(e=>({any:parseInt(e.Any,10),mitjana:parseFloat(e.Mitjana)})).sort((e,t)=>e.any-t.any)),d=[...new Set(i.flat().map(e=>e.any))].sort((e,t)=>e-t),l=["blue","green","red"],s=r.map((e,t)=>({label:e,data:d.map(e=>{const n=i[t].find(t=>t.any===e);return n?Number.parseFloat(n.mitjana):null}),borderColor:l[t],backgroundColor:l[t],tension:.2,fill:!1})),m=document.getElementById("chart-canvas"),p=document.getElementById("chart-overlay");p&&(p.style.display="flex",o=document.activeElement);const u=document.getElementById("close-chart");u&&u.focus(),a();const h=document.getElementById("chart-title");h&&(h.textContent=c);const g=m.getContext("2d");e.lineChart&&e.lineChart.destroy(),t(new Chart(g,{type:"line",data:{labels:d,datasets:s},options:{plugins:{legend:{position:"right"}},scales:{x:{title:{display:!0,text:"Any"},ticks:{stepSize:1,autoSkip:!1}},y:{title:{display:!0,text:"Mitjana"},suggestedMin:(()=>{const e=s.flatMap(e=>e.data).filter(e=>null!=e),t=e.length?Math.min(...e):0;return Math.floor(10*(t-.1))/10})(),suggestedMax:(()=>{const e=s.flatMap(e=>e.data).filter(e=>null!=e),t=e.length?Math.max(...e):1;return Math.ceil(10*(t+.1))/10})(),ticks:{beginAtZero:!1,stepSize:.1}}},responsive:!0,maintainAspectRatio:!1}}))}function r(){const t=document.getElementById("content");t.innerHTML="";const a=document.createElement("table"),o=document.createElement("tr");["Posició","Jugador","Mitjana"].forEach(e=>{const t=document.createElement("th");t.textContent=e,o.appendChild(t)}),a.appendChild(o);e.ranquing.filter(t=>parseInt(t.Any,10)===e.anySeleccionat&&t.Modalitat===e.modalitatSeleccionada).sort((e,t)=>parseFloat(t.Mitjana)-parseFloat(e.Mitjana)).forEach((e,t)=>{const n=document.createElement("tr");["Posició","Jugador","Mitjana"].forEach(a=>{const o=document.createElement("td");let r;r="Posició"===a?t+1:"Mitjana"===a?Number.parseFloat(e[a]).toFixed(3):"Jugador"===a?e.NomComplet:e[a],o.textContent=r,"Jugador"===a&&(o.classList.add("player-cell"),o.addEventListener("click",t=>{t.stopPropagation(),c(e.Jugador,e.NomComplet)})),n.appendChild(o)}),n.addEventListener("click",()=>{c(e.Jugador,e.NomComplet)}),a.appendChild(n)}),n(t,a)}function i(){const t=document.getElementById("content");t.innerHTML="";const a=document.createElement("table"),o=document.createElement("tr");["#","Jugador","PJ","P","C","E","MG","MM"].forEach(e=>{const t=document.createElement("th");t.textContent=e,o.appendChild(t)}),a.appendChild(o);e.classificacions.filter(t=>parseInt(t.Any,10)===e.classAnySeleccionat&&t.Modalitat===e.classModalitatSeleccionada&&t.Categoria===e.classCategoriaSeleccionada).sort((e,t)=>parseInt(e.Posició,10)-parseInt(t.Posició,10)).forEach(e=>{const t=document.createElement("tr");[e["Posició"],e.Jugador||e.Nom||"",e.PartidesJugades||e["Partides jugades"]||e.PJ||"",e.Punts,e.Caramboles,e.Entrades,e.MitjanaGeneral||e.Mitjana||"",e.MitjanaParticular||e["Millor mitjana"]||""].forEach((e,n)=>{const a=document.createElement("td");if(n>=6&&""!==e){const t=Number.parseFloat(e);e=Number.isNaN(t)?e:t.toFixed(3)}a.textContent=e,t.appendChild(a)}),a.appendChild(t)}),n(t,a)}function d(t,n){const a=document.getElementById("torneig-category-buttons");if(a.innerHTML="",!t||0===t.length)return a.style.display="none",e.torneigCategoriaSeleccionada=null,void n();t.sort(),e.torneigCategoriaSeleccionada&&t.includes(e.torneigCategoriaSeleccionada)||(e.torneigCategoriaSeleccionada=t[0]),t.forEach(t=>{const o=document.createElement("button");o.textContent=`${t}a`,t===e.torneigCategoriaSeleccionada&&o.classList.add("selected"),o.addEventListener("click",()=>{e.torneigCategoriaSeleccionada=t,a.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),o.classList.add("selected"),n()}),a.appendChild(o)}),a.style.display="flex",n()}function l(t,a){const o=document.getElementById("content");o.innerHTML="";const c=document.getElementById("torneig-category-buttons");if(c.style.display="none",c.innerHTML="","calendari.json"===a)return void function(e){const t=document.getElementById("content");if(t.innerHTML="",!Array.isArray(e))return void(t.textContent="Dades de calendari no vàlides.");const a=e.filter(e=>e.Data),o=e.filter(e=>!e.Data);a.sort((e,t)=>{const n=(e.Data||"").localeCompare(t.Data||"");if(0!==n)return n;const a=(e.Hora||"").localeCompare(t.Hora||"");return 0!==a?a:(parseInt((e.Billar||"").match(/\d+/),10)||0)-(parseInt((t.Billar||"").match(/\d+/),10)||0)});const c=document.createElement("div");c.id="calendari-filters";const r=document.createElement("input");r.id="calendari-player-filter",r.type="text",r.placeholder="Filtre Nom Jugador",c.appendChild(r),t.appendChild(c);const i=document.createElement("div");t.appendChild(i);const d={"01":"gen","02":"feb","03":"mar","04":"abr","05":"mai","06":"jun","07":"jul","08":"ago","09":"set",10:"oct",11:"nov",12:"des"};function l(e=""){e=(e||"").toLowerCase(),i.innerHTML="";const t=a.filter(t=>{if(!e)return!0;const n=(t["Jugador A"]||"").trim().toLowerCase(),a=(t["Jugador B"]||"").trim().toLowerCase();return n.includes(e)||a.includes(e)}),c=t.reduce((e,t)=>(e[t.Data]=(e[t.Data]||0)+1,e),{}),r=document.createElement("table"),l=document.createElement("tr");["Data","Hora","Billar","Jugador A","Jugador B"].forEach(e=>{const t=document.createElement("th");t.textContent=e,l.appendChild(t)}),r.appendChild(l);let s=null;t.forEach(e=>{const t=document.createElement("tr");if(e.Data!==s){const n=document.createElement("td"),[a,o,r]=(e.Data||"").split("-"),i=parseInt(r,10),l=o&&i?`${i}<br>${d[o]||o}`:"";n.innerHTML=l;const m=c[e.Data];m>1&&(n.rowSpan=m,n.classList.add("vertical-text")),t.appendChild(n),s=e.Data}const n=(e.Billar||"").replace("Billar ","B");let a=e.Hora||"";/^\d{1,2}:00$/.test(a)&&(a=a.split(":")[0]),[a,n,(e["Jugador A"]||"").trim(),(e["Jugador B"]||"").trim()].forEach(e=>{const n=document.createElement("td");n.textContent=e,t.appendChild(n)}),r.appendChild(t)}),n(i,r);const m=o.filter(t=>{if(!e)return!0;const n=(t["Jugador A"]||"").trim().toLowerCase(),a=(t["Jugador B"]||"").trim().toLowerCase();return n.includes(e)||a.includes(e)}).sort((e,t)=>(parseInt(e.Jornada,10)||0)-(parseInt(t.Jornada,10)||0));if(m.length>0){const e=document.createElement("h3");e.textContent="Pendent de programar",i.appendChild(e);const t=document.createElement("table"),a=document.createElement("tr");["Jornada","J1","J2"].forEach(e=>{const t=document.createElement("th");t.textContent=e,a.appendChild(t)}),t.appendChild(a),m.forEach(e=>{const n=document.createElement("tr");[e.Jornada||"",(e["Jugador A"]||"").trim(),(e["Jugador B"]||"").trim()].forEach(e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)}),t.appendChild(n)}),n(i,t)}}r.addEventListener("input",()=>{l(r.value.trim().toLowerCase())}),l()}(t);if("partides.json"===a){return void d([...new Set(t.map(e=>e["🏆 Categoria de la partida"]))],()=>function(t){const a=document.getElementById("content");if(a.innerHTML="",!Array.isArray(t))return void(a.textContent="Dades de partides no vàlides.");t.sort((e,t)=>{const n=new Date(e.Timestamp);return new Date(t.Timestamp)-n});const o=document.createElement("div");o.id="partides-filters";const c=document.createElement("input");c.id="partides-player-filter",c.type="text",c.placeholder="Filtre Nom Jugador",o.appendChild(c),a.appendChild(o);const r=document.createElement("div");function i(a=""){a=(a||"").toLowerCase(),r.innerHTML="",t.filter(t=>t["🏆 Categoria de la partida"]===e.torneigCategoriaSeleccionada).filter(e=>{if(!a)return!0;const t=(e["🎱 Nom del Jugador 1"]||"").trim().toLowerCase(),n=(e["🎱 Nom del Jugador 2"]||"").trim().toLowerCase();return t.includes(a)||n.includes(a)}).forEach((e,t)=>{const a=(e["🎱 Nom del Jugador 1"]||"").trim(),o=(e["🎱 Nom del Jugador 2"]||"").trim(),c=parseInt(e["🔢 Caramboles del Jugador 1"],10)||0,i=parseInt(e["🔢 Caramboles del Jugador 2"],10)||0,d=e["⏱️ Entrades de la partida"]||"",l=(parseFloat(e["Mitjana J1"])||0).toFixed(3),s=(parseFloat(e["Mitjana J2"])||0).toFixed(3),m=c>i?" 🏆":"",p=i>c?" 🏆":"",u=document.createElement("table");u.className="partida";const h=document.createElement("colgroup");if(["jugadors","c","e","m"].forEach(e=>{const t=document.createElement("col");t.className=e,h.appendChild(t)}),u.appendChild(h),0===t){const e=document.createElement("thead"),t=document.createElement("tr");["Jugadors","C","E","M"].forEach(e=>{const n=document.createElement("th");n.textContent=e,t.appendChild(n)}),e.appendChild(t),u.appendChild(e)}const g=document.createElement("tbody"),E=document.createElement("tr"),C=document.createElement("tr"),f=document.createElement("td");f.textContent=`${a}${m}`;const b=document.createElement("td");b.textContent=c;const y=document.createElement("td");y.textContent=d,y.rowSpan=2;const v=document.createElement("td");v.textContent=l,E.appendChild(f),E.appendChild(b),E.appendChild(y),E.appendChild(v);const x=document.createElement("td");x.textContent=`${o}${p}`;const L=document.createElement("td");L.textContent=i;const I=document.createElement("td");I.textContent=s,C.appendChild(x),C.appendChild(L),C.appendChild(I),g.appendChild(E),g.appendChild(C),u.appendChild(g),n(r,u)})}a.appendChild(r),c.addEventListener("input",()=>{i(c.value.trim().toLowerCase())}),i()}(t))}if(!t)return;if(Array.isArray(t)&&0===t.length){const e=document.createElement("p");return e.textContent="No hi ha dades.",void o.appendChild(e)}if("classificacio.json"!==a&&Array.isArray(t)&&t[0]&&("Categoria jugador"in t[0]&&"Nom jugador"in t[0]||"Categoria"in t[0]&&"Nom"in t[0])){const n="Categoria jugador"in t[0]?"Categoria jugador":"Categoria",a="Nom jugador"in t[0]?"Nom jugador":"Nom",c=t.reduce((e,t)=>{const o=t[n];return e[o]||(e[o]=[]),e[o].push((t[a]||"").trim()),e},{});return void d(Object.keys(c),()=>{o.innerHTML="";const t=e.torneigCategoriaSeleccionada,n=document.createElement("h3"),a=e.torneigCaramboles[t];n.textContent=a?`${t}a categoria (${a} caramboles)`:`${t}a categoria`,o.appendChild(n);const r=document.createElement("ul");(c[t]||[]).forEach(e=>{const t=document.createElement("li");t.textContent=e,r.appendChild(t)}),o.appendChild(r)})}if("classificacio.json"===a&&Array.isArray(t)&&t[0]&&"Posició"in t[0]){const a=t.reduce((e,t)=>{const n=t.Categoria||"";return e[n]||(e[n]=[]),e[n].push(t),e},{});return void d(Object.keys(a),()=>{o.innerHTML="";const t=e.torneigCategoriaSeleccionada,c=document.createElement("h3"),r=e.torneigCaramboles[t];c.textContent=r?`${t}a categoria (${r} caramboles)`:`${t}a categoria`,o.appendChild(c);const i=document.createElement("table"),d=document.createElement("tr");["#","Jugador","PJ","P","C","E","MG","MM"].forEach(e=>{const t=document.createElement("th");t.textContent=e,d.appendChild(t)}),i.appendChild(d),(a[t]||[]).sort((e,t)=>{const n=parseInt(e.Punts,10)||0,a=parseInt(t.Punts,10)||0;if(a!==n)return a-n;const o=parseFloat(e.MitjanaGeneral||e.Mitjana||"0");return parseFloat(t.MitjanaGeneral||t.Mitjana||"0")-o}).forEach((e,t)=>{const n=document.createElement("tr");[t+1,e.Nom||"",e.PartidesJugades||e["Partides jugades"]||e.PJ||"",e.Punts,e.Caramboles,e.Entrades,e.MitjanaGeneral||e.Mitjana||"",e.MitjanaParticular||e["Millor mitjana"]||""].forEach((e,t)=>{const a=document.createElement("td");if(t>=6&&""!==e){const t=Number.parseFloat(e);e=Number.isNaN(t)?e:t.toFixed(3)}a.textContent=e,n.appendChild(a)}),i.appendChild(n)}),n(o,i)})}if(Array.isArray(t)&&t[0]&&"Categoria"in t[0]){const a=t.reduce((e,t)=>{const n=t.Categoria||"";return e[n]||(e[n]=[]),e[n].push(t),e},{}),c=Object.keys(t[0]).filter(e=>"Categoria"!==e);return void d(Object.keys(a),()=>{o.innerHTML="";const t=e.torneigCategoriaSeleccionada,r=document.createElement("h3"),i=e.torneigCaramboles[t];r.textContent=i?`${t}a categoria (${i} caramboles)`:`${t}a categoria`,o.appendChild(r);const d=document.createElement("table"),l=document.createElement("tr");c.forEach(e=>{const t=document.createElement("th");t.textContent=e,l.appendChild(t)}),d.appendChild(l),(a[t]||[]).forEach(e=>{const t=document.createElement("tr");c.forEach(n=>{const a=document.createElement("td");a.textContent=e[n]||"",t.appendChild(a)}),d.appendChild(t)}),n(o,d)})}if(Array.isArray(t)&&Array.isArray(t[0])){const e=t[0],a=document.createElement("table"),c=document.createElement("tr");return e.forEach(e=>{const t=document.createElement("th");t.textContent=e,c.appendChild(t)}),a.appendChild(c),t.slice(1).forEach(t=>{const n=document.createElement("tr");e.forEach((e,a)=>{const o=document.createElement("td");o.textContent=t[a]||"",n.appendChild(o)}),a.appendChild(n)}),void n(o,a)}if(Array.isArray(t)&&"object"==typeof t[0]){const e=[...new Set(t.flatMap(e=>Object.keys(e)))],a=document.createElement("table"),c=document.createElement("tr");return e.forEach(e=>{const t=document.createElement("th");t.textContent=e,c.appendChild(t)}),a.appendChild(c),t.forEach(t=>{const n=document.createElement("tr");e.forEach(e=>{const a=document.createElement("td");a.textContent=t[e]||"",n.appendChild(a)}),a.appendChild(n)}),void n(o,a)}const r=document.createElement("pre");r.textContent=JSON.stringify(t,null,2),o.appendChild(r)}const s=["filters-row","classificacio-filters","torneig-buttons","torneig-title","torneig-category-buttons","continu3b-buttons","content"];function m(){s.forEach(e=>{const t=document.getElementById(e);t&&(t.style.display="none")})}const p={"btn-ranking":{show:[{id:"filters-row",display:"flex"}],action:r},"btn-classificacio":{show:[{id:"classificacio-filters",display:"flex"}],action:i},"btn-agenda":{action:function(){const t=document.getElementById("content");t.innerHTML="";const a=document.createElement("div");a.id="calendar-container";const o=document.createElement("div");o.className="calendar-nav";const c=document.createElement("button");c.textContent="<";const r=document.createElement("button");r.textContent=">";const i=document.createElement("span");i.id="calendar-month",c.addEventListener("click",()=>{e.agendaSetmanaInici.setDate(e.agendaSetmanaInici.getDate()-7),h()}),r.addEventListener("click",()=>{e.agendaSetmanaInici.setDate(e.agendaSetmanaInici.getDate()+7),h()}),o.appendChild(c),o.appendChild(i),o.appendChild(r),a.appendChild(o);const d=document.createElement("table");d.className="calendar-table";const l=document.createElement("tr");["Dl","Dt","Dc","Dj","Dv","Ds","Dg"].forEach(e=>{const t=document.createElement("th");t.textContent=e,l.appendChild(t)}),d.appendChild(l);const s=document.createElement("tbody");d.appendChild(s),n(a,d),t.appendChild(a);const m=document.createElement("table");m.id="event-list",m.classList.add("agenda-table"),n(t,m);const p=new Date;let u=new Date(Date.UTC(p.getFullYear(),p.getMonth(),p.getDate())).toISOString().split("T")[0];function h(){const t=new Date(e.agendaSetmanaInici);t.setDate(e.agendaSetmanaInici.getDate()+6);const n=new Date(e.agendaSetmanaInici);n.setDate(e.agendaSetmanaInici.getDate()+7),(new Date(u)<e.agendaSetmanaInici||new Date(u)>=n)&&(u=e.agendaSetmanaInici.toISOString().split("T")[0]);const a=e.agendaSetmanaInici.toLocaleDateString("ca-ES",{day:"numeric",month:"short"}),o=t.toLocaleDateString("ca-ES",{day:"numeric",month:"short",year:"numeric"});i.textContent=`${a} - ${o}`,function(){s.innerHTML="";const t=document.createElement("tr");for(let n=0;n<7;n++){const a=document.createElement("td"),o=new Date(e.agendaSetmanaInici);o.setDate(e.agendaSetmanaInici.getDate()+n);const c=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())).toISOString().split("T")[0];a.textContent=o.getDate(),a.dataset.date=c;const r=e.events.filter(e=>e.Data===c);if(r.length>0){let e="event-other";r.some(e=>"festiu"===e.Tipus)?e="event-festiu":r.some(e=>"assemblea"===e.Tipus)?e="event-assemblea":r.some(e=>"partida"===e.Tipus)?e="event-partida":r.some(e=>e["Títol"].includes("Fi"))?e="event-fi":r.some(e=>e["Títol"].includes("Inici"))&&(e="event-inici"),a.classList.add(e)}c===u&&a.classList.add("selected-day"),a.addEventListener("click",()=>{u=c,h()}),t.appendChild(a)}s.appendChild(t)}(),function(){m.innerHTML="";const t=document.createElement("tr");["Data","Títol"].forEach(e=>{const n=document.createElement("th");n.textContent=e,t.appendChild(n)}),m.appendChild(t),e.events.filter(e=>e.Data===u).sort((e,t)=>(e.Hora||"").localeCompare(t.Hora||"")).forEach(e=>{const t=document.createElement("tr");t.dataset.date=e.Data;let n="event-other";"festiu"===e.Tipus?n="event-festiu":"assemblea"===e.Tipus?n="event-assemblea":"partida"===e.Tipus?n="event-partida":e["Títol"].includes("Fi")?n="event-fi":e["Títol"].includes("Inici")&&(n="event-inici"),t.classList.add(n),["Data","Títol"].forEach(n=>{const a=document.createElement("td");if("Data"===n){const[t,n,o]=(e.Data||"").split("-");a.textContent=`${o}/${n}`}else a.textContent=e[n]||"";t.appendChild(a)}),m.appendChild(t)})}()}h()}},"btn-horari":{action:function(){document.getElementById("content").innerHTML='\n<div class="normes-container">\n  <h2 class="normes-title">Normes d’ús i horari</h2>\n\n  \x3c!-- Horari --\x3e\n  <div class="normes-card horari">\n    <h3>🕒 Horari d\'obertura de la Secció</h3>\n    <ul>\n      <li><b>Dilluns, dimecres, dijous, dissabte i diumenge:</b> 9:00 – 21:30</li>\n      <li><b>Dimarts i divendres:</b> 10:30 – 21:30</li>\n      <li>L\'horari d\'obertura pot canviar en funció dels horaris d\'obertura del <b>Bar del Foment</b>.</li>\n      <li>L\'horari d\'atenció al públic del <b>FOMENT</b> és de <b>DILLUNS A DIVENDRES</b> de <b>9:00 A 13:00</b> i de <b>16:00 A 20:00</b>.</li>\n      <li>Les seccions poden tenir activitat fora d\'aquest horari si el bar està obert, excepte <b>AGOST</b> i <b>FESTIUS</b>, quan el <b>FOMENT</b> resta oficialment tancat.</li>\n      <li>La secció romandrà tancada els dies de <b>TANCAMENT OFICIAL</b> del <b>FOMENT</b>.</li>\n\n    </ul>\n  </div>\n\n  \x3c!-- Norma Obligatòria --\x3e\n  <div class="normes-card obligatori">\n    <h3>🚨 OBLIGATORI</h3>\n    <p class="obligatori-text">\n      Netejar el billar i les boles abans de començar cada partida amb el material que la Secció posa a disposició de tots els socis.\n    </p>\n  </div>\n\n  \x3c!-- Prohibicions --\x3e\n  <div class="normes-card prohibit">\n\n    <h3>🚫 PROHIBIT</h3>\n\n    <ul>\n      <li>Jugar a fantasia.</li>\n      <li>Menjar mentre s\'està jugant.</li>\n      <li>Posar begudes sobre cap element del billar.</li>\n    </ul>\n  </div>\n\n  \x3c!-- Inscripció --\x3e\n  <div class="normes-card">\n    <h3>📝 Inscripció a les partides</h3>\n    <ul>\n      <li>Apunta’t a la pissarra única de <b>PARTIDES SOCIALS</b>.</li>\n      <li>Els companys no cal que s’apuntin; si ho fan, que sigui al costat del primer jugador.</li>\n    </ul>\n  </div>\n\n  \x3c!-- Assignació de taula --\x3e\n  <div class="normes-card">\n    <h3>🗂 Assignació de taula</h3>\n    <ul>\n      <li>Quan hi hagi una taula lliure, ratlla el teu nom i juga.</li>\n      <li>Si vols una taula concreta ocupada, <b>passa el torn</b> fins que s’alliberi.</li>\n    </ul>\n  </div>\n\n  \x3c!-- Temps de joc --\x3e\n  <div class="normes-card">\n    <h3>⏳ Temps de joc</h3>\n    <ul>\n      <li>Màxim <b>1 hora</b> per partida (sol o en grup).</li>\n      <li><b>PROHIBIT</b> posar monedes per allargar el temps, encara que hi hagi taules lliures.</li>\n    </ul>\n  </div>\n\n  \x3c!-- Tornar a jugar --\x3e\n  <div class="normes-card">\n    <h3>🔄 Tornar a jugar</h3>\n    <ul>\n      <li>Només pots repetir si <b>no hi ha ningú apuntat</b> i hi ha una taula lliure.</li>\n    </ul>\n  </div>\n</div>\n  '}},"btn-enllacos":{action:function(){const e=document.getElementById("content");e.innerHTML="",fetch("data/enllacos.json").then(e=>e.json()).then(t=>{const n={};t.forEach(e=>{const t=e.Tipus||"Altres";n[t]||(n[t]=[]),n[t].push(e)}),Object.entries(n).forEach(([t,n])=>{const a=document.createElement("details"),o=document.createElement("summary");o.textContent=t,o.classList.add("enllac-tipus"),a.appendChild(o),n.forEach(e=>{const t=e.URL||e.Url||e.url;if(t){const n=a.querySelector("ul")||document.createElement("ul"),o=document.createElement("li"),c=document.createElement("a");c.href=t,c.target="_blank",c.rel="noopener";let r=e.Títol||e.Titol||e.Nom||e.Name||e.Text||t;e.Billar&&(r+=` - Billar ${e.Billar}`),c.textContent=r,o.appendChild(c),n.appendChild(o),a.appendChild(n)}}),e.appendChild(a)})}).catch(t=>{e.textContent="No s'han pogut carregar els enllaços.",console.error("Error loading links",t)})}},"btn-continu3b":{show:[{id:"continu3b-buttons",display:"flex"}],action:function(){const e=document.getElementById("content");e.innerHTML="";const t=document.getElementById("continu3b-buttons");t.innerHTML="",Promise.all([fetch("data/continu3b_rankingactiu.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_llistaespera.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_reptes.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_partides.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_jugadors.json").then(e=>e.json()).catch(()=>[]),fetch("data/continu3b_parametres.json").then(e=>e.json()).catch(()=>[])]).then(([a,o,c,r,i,d])=>{const l=Object.fromEntries(i.map(e=>[e.id,e.nom])),s=parseInt((d.find(e=>"COOLDOWN_REPTAR_DIES"===e.clau)||{}).valor,10)||7;const m=(n,a)=>{t.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),n.classList.add("selected"),e.innerHTML="",a()},p=document.createElement("label");p.id="ranking-filter-disponibles";const u=document.createElement("input");u.type="checkbox",p.appendChild(u),p.appendChild(document.createTextNode(" Mostra només disponibles"));const h=document.createElement("button");h.textContent="Rànquing actual",u.addEventListener("change",()=>h.click()),h.addEventListener("click",()=>m(h,()=>{const t=document.createElement("h3");if(t.textContent="Rànquing actual",e.appendChild(t),Array.isArray(a)&&a.length){const t=document.createElement("table");t.classList.add("ranking-table");const o=document.createElement("thead"),d=document.createElement("tr");["Posició","Jugador","Dies per reptar/ser reptat","Disponible"].forEach(e=>{const t=document.createElement("th");t.textContent=e,d.appendChild(t)}),o.appendChild(d),t.appendChild(o);const m=document.createElement("tbody");a.slice().sort((e,t)=>parseInt(e.posicio)-parseInt(t.posicio)).forEach(t=>{const a=i.find(e=>e.id===t.jugador_id),{dies:o,data:d}=(e=>{if(!e)return{dies:null,data:""};const[t,n,a]=e.split("/"),o=new Date(`${a}-${n}-${t}T00:00:00`);return isNaN(o)?{dies:null,data:""}:{dies:Math.floor((Date.now()-o.getTime())/864e5),data:`${t}/${n}/${a}`}})(a?a.data_ultim_repte:""),p=c.find(e=>(e.reptador_id===t.jugador_id||e.reptat_id===t.jugador_id)&&["proposat","acceptat","programat"].includes(e.estat)),g=((e,t,n,a)=>{if(1===parseInt(n,10))return!1;if(a){if(a.data_programa)return!1;{let e=0,t="";if("proposat"===a.estat?(e=14,t=a.created_at):"acceptat"===a.estat&&(e=7,t=a.data_acceptacio||a.created_at),!e)return!1;if(Math.floor((Date.now()-new Date(t).getTime())/864e5)<e)return!1}}return null==t||t>=s})(t.jugador_id,o,t.posicio,p);if(u.checked&&!g)return;const E=document.createElement("tr"),C=document.createElement("td");C.textContent=t.posicio,C.classList.add("ranking-pos"),E.appendChild(C);const f=l[t.jugador_id]||t.jugador_id,b=document.createElement("button");b.textContent=f,b.addEventListener("click",()=>function(t,a){e.innerHTML="";const o=document.createElement("h3");o.textContent=`Partides de ${a}`,e.appendChild(o);const c=r.filter(e=>e.local_id===t||e.visitant_id===t);if(c.length){const a=document.createElement("table"),o=document.createElement("thead"),r=document.createElement("tr");["Data","Rival","Resultat"].forEach(e=>{const t=document.createElement("th");t.textContent=e,r.appendChild(t)}),o.appendChild(r),a.appendChild(o);const i=document.createElement("tbody");c.forEach(e=>{const n=document.createElement("tr"),a=e.data?new Date(e.data).toLocaleDateString("ca-ES"):"",o=e.local_id===t,c=o?e.visitant_id:e.local_id;[a,l[c]||c,e.caramboles_local&&e.caramboles_visitant?o?`${e.caramboles_local}-${e.caramboles_visitant}`:`${e.caramboles_visitant}-${e.caramboles_local}`:""].forEach(e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)}),i.appendChild(n)}),a.appendChild(i),n(e,a)}else{const t=document.createElement("p");t.textContent="No hi ha partides per aquest jugador.",e.appendChild(t)}const i=document.createElement("button");i.textContent="Torna",i.addEventListener("click",()=>h.click()),e.appendChild(i)}(t.jugador_id,f));const y=document.createElement("td");y.classList.add("ranking-name"),y.appendChild(b),E.appendChild(y);const v=document.createElement("td");let x=0;if(p&&!p.data_programa){let e=0,t="";if("proposat"===p.estat?(e=7,t=p.created_at):"acceptat"===p.estat&&(e=7,t=p.data_acceptacio||p.created_at),e){const n=Math.floor((Date.now()-new Date(t).getTime())/864e5);x=Math.max(e-n,0)}}else null!=o&&(x=Math.max(s-o,0),d&&(v.title=`Últim repte: ${d}`));v.textContent=`${x} dies`,v.dataset.label="Dies per reptar/ser reptat",E.appendChild(v);const L=document.createElement("span");L.textContent=g?"🟢":"🔴",L.title=g?"Pot reptar i ser reptat":"No pot reptar ni ser reptat";const I=document.createElement("td");I.dataset.label="Disponible",I.appendChild(L),E.appendChild(I),m.appendChild(E)}),t.appendChild(m);const g=document.createElement("div");["🟢 Pot reptar i ser reptat","🔴 No pot reptar ni ser reptat"].forEach(e=>{const t=document.createElement("p");t.textContent=e,g.appendChild(t)}),e.appendChild(g),e.appendChild(p),n(e,t)}else{const t=document.createElement("p");t.textContent="No hi ha rànquing disponible.",e.appendChild(t)}}));const g=(t,n)=>{const a=c.filter(n),o=a.filter(e=>"proposat"===e.estat),i=a.filter(e=>"acceptat"===e.estat),d=a.filter(e=>"programat"===e.estat),s=a.filter(e=>"tancat"===e.estat),m=document.createElement("h3");m.textContent=t,e.appendChild(m);const p=(t,n,a=e)=>{t.forEach(e=>{const t=document.createElement("div");t.classList.add("repte-card");const o=l[e.reptador_id]||e.reptador_id,c=l[e.reptat_id]||e.reptat_id,r=document.createElement("h4");r.textContent=`${o} vs ${c}`,t.appendChild(r);n(e).forEach(([e,n])=>{if(n){const a=document.createElement("p"),o=new Date(n);a.textContent=`${e}: ${isNaN(o)?n:o.toLocaleDateString("ca-ES")}`,t.appendChild(a)}}),a.appendChild(t)})},u=(t,n,a,o)=>{const c=document.createElement("h4");if(c.textContent=t,e.appendChild(c),n.length)p(n,a);else{const t=document.createElement("p");t.textContent=o,e.appendChild(t)}},h=e=>e?new Date(new Date(e).getTime()+6048e5):null,g=Object.fromEntries(r.map(e=>[e.id,e])),E={REFUS:"Refús",INCOMPAREIXENCA:"Incompareixença",RESULTAT:"Resultat"},C=e=>{const t=g[e.partida_id]||{},n=!t.data&&e.resultat_motiu?E[e.resultat_motiu]||e.resultat_motiu:null;return[["Creació",e.created_at],["Acceptació",e.data_acceptacio],["Programació",e.data_programa],["Jugat",t.data],["Motiu tancament",n]]};u("Pendents d’acceptar",o,e=>{const t=h(e.created_at),n=h(t);return[["Creació",e.created_at],["Límit acceptar",t],["Límit jugar",n]]},"No hi ha reptes pendents."),u("Acceptats",i,e=>[["Creació",e.created_at],["Acceptació",e.data_acceptacio],["Límit jugar",h(e.data_acceptacio||e.created_at)]],"No hi ha reptes acceptats."),u("Programats",d,e=>[["Creació",e.created_at],["Acceptació",e.data_acceptacio],["Programació",e.data_programa],["Límit jugar",h(e.data_acceptacio||e.created_at)]],"No hi ha reptes programats.");const f=document.createElement("details");f.id="reptes-tancats";const b=document.createElement("summary");if(b.textContent="Tancats",f.appendChild(b),s.length)p(s,C,f);else{const e=document.createElement("p");e.textContent="No hi ha reptes tancats.",f.appendChild(e)}e.appendChild(f)},E=document.createElement("button");E.textContent="Reptes",E.addEventListener("click",()=>m(E,()=>g("Reptes",e=>"acces"!==e.tipus)));const C=document.createElement("button");C.textContent="Llista d'espera",C.addEventListener("click",()=>m(C,()=>{const t=document.createElement("h3");if(t.textContent="Llista d'espera",e.appendChild(t),Array.isArray(o)&&o.length){const t=document.createElement("table");t.classList.add("ranking-table","no-medals");const a=document.createElement("thead"),c=document.createElement("tr");["Posició","Jugador","Pot reptar"].forEach(e=>{const t=document.createElement("th");t.textContent=e,c.appendChild(t)}),a.appendChild(c),t.appendChild(a);const r=document.createElement("tbody");o.slice().sort((e,t)=>parseInt(e.ordre,10)-parseInt(t.ordre,10)).forEach((e,t)=>{const n=document.createElement("tr"),a=document.createElement("td");a.textContent=e.ordre,a.classList.add("ranking-pos"),n.appendChild(a);const o=l[e.jugador_id]||e.jugador_id,c=document.createElement("button");c.textContent=o,c.addEventListener("click",()=>mostraEvolucioJugador(e.jugador_id,o));const i=document.createElement("td");i.classList.add("ranking-name"),i.appendChild(c),n.appendChild(i);const d=document.createElement("td"),s=document.createElement("span"),m=0===t;s.textContent=m?"🟢":"🔴",s.title=m?"Pot reptar el jugador 20":"No pot reptar",d.dataset.label="Pot reptar",d.appendChild(s),n.appendChild(d),r.appendChild(n)}),t.appendChild(r);const i=document.createElement("div");["🟢 Pot reptar","🔴 No pot reptar"].forEach(e=>{const t=document.createElement("p");t.textContent=e,i.appendChild(t)}),e.appendChild(i),n(e,t)}else{const t=document.createElement("p");t.textContent="No hi ha jugadors en llista d'espera.",e.appendChild(t)}}));const f=document.createElement("button");f.textContent="Reptes accés",f.addEventListener("click",()=>m(f,()=>g("Reptes accés",e=>"acces"===e.tipus)));const b=document.createElement("button");b.textContent="Partides",b.addEventListener("click",()=>m(b,()=>{const t=document.createElement("h3");if(t.textContent="Partides",e.appendChild(t),Array.isArray(r)&&r.length){const t=Object.fromEntries(a.map(e=>[e.jugador_id,parseInt(e.posicio,10)]));r.slice().sort((e,t)=>new Date(t.data)-new Date(e.data)).forEach(n=>{const a=document.createElement("div");a.classList.add("partida-card");const o=c.find(e=>e.id===n.repte_id)||{},r=l[n.local_id]||n.local_id,i=l[n.visitant_id]||n.visitant_id;let d="";n.caramboles_local&&n.caramboles_visitant?d=`${n.caramboles_local}-${n.caramboles_visitant}`:o.resultat_motiu&&"RESULTAT"!==o.resultat_motiu&&(d=o.resultat_motiu.toLowerCase().replace(/_/g," "),d=d.charAt(0).toUpperCase()+d.slice(1));const s=t[n.local_id],m=t[n.visitant_id],p="TRUE"===o.resultat_guanya_reptador;let u=s,h=m;p&&void 0!==s&&void 0!==m&&(u=m,h=s);const g=void 0!==u?u:"-",E=void 0!==h?h:"-",C=p?"Intercanvi de posicions":"No intercanvi de posicions",f=n.data?new Date(n.data).toLocaleDateString("ca-ES"):"";a.innerHTML=`\n                <h4>${f}</h4>\n                <p>${r} (Pos. ${g}) vs ${i} (Pos. ${E})</p>\n                <p>Resultat: ${d}</p>\n                <p>${C}</p>\n              `,e.appendChild(a)})}else{const t=document.createElement("p");t.textContent="No hi ha partides registrades.",e.appendChild(t)}}));const y=document.createElement("button");y.textContent="Normativa",y.addEventListener("click",()=>m(y,()=>{e.innerHTML='\n<div class="normes-container">\n  <h2 class="normes-title">Normativa Continu 3B</h2>\n\n  <div class="normes-card">\n    <h3>📊 Rànquing actiu</h3>\n    <ul>\n      <li><strong>Màxim 20 jugadors</strong>, actualitzat contínuament mitjançant reptes directes</li>\n      <li>Els jugadors que vulguin formar part del rànquing un cop s\'arribi al màxim de 20 jugadors formaran part de la <strong>llista d\'espera</strong>.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <h3>⚔️ Reptes normals</h3>\n    <ul>\n      <li>Pots reptar fins a <strong>2 posicions</strong> per sobre teu.</li>\n      <li><strong>Màxim un repte actiu</strong> per jugador.</li>\n      <li><strong>Mínim 7 dies</strong> entre reptes.</li>\n      <li>Si guanya el reptador → <strong>intercanvi de posicions</strong>.</li>\n      <li>Si perd el reptador → <strong>no hi ha canvis</strong>.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <h3>🚪 Reptes d’accés</h3>\n    <ul>\n      <li><strong>Primer de la llista d’espera</strong> pot reptar el jugador 20.</li>\n      <li>Si guanya → <strong>entra al rànquing</strong> (pos. 20) i el perdedor passa a la llista d’espera.</li>\n      <li>Si perd → passa al final de la <strong>llista d’espera</strong>.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <h3>⏱️ Terminis</h3>\n    <p><strong>7 dies</strong> per acceptar un repte i <strong>7 dies</strong> per jugar-lo un cop acceptat.</p>\n  </div>\n\n  <div class="normes-card">\n    <h3>⚠️ Penalitzacions</h3>\n    <ul>\n      <li>Incompareixença o refús sense motiu → <strong>derrota automàtica</strong>.</li>\n      <li>Sense acord de data → tots dos <strong>perden una posició</strong>.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <h3>😴 Inactivitat</h3>\n    <ul>\n      <li><strong>3 setmanes</strong> sense reptes → baixa 5 posicions (pre-inactiu).</li>\n      <li><strong>6 setmanes</strong> sense reptes → surt del rànquing i entra el primer de la llista d’espera.</li>\n    </ul>\n  </div>\n\n  <div class="normes-card">\n    <p>Consulta la <a href="https://docs.google.com/document/d/165_bh9m0WxRU_LoTt_k8aiJseZZn9bBZ/edit?usp=sharing&amp;ouid=102336298592739127647&amp;rtpof=true&amp;sd=true" target="_blank" rel="noopener"><strong>normativa completa</strong></a>.</p>\n  </div>\n</div>'})),[h,E,C,f,b,y].forEach(e=>t.appendChild(e)),h.click()}).catch(t=>{console.error("Error carregant dades continu 3B",t),e.innerHTML="<p>Error carregant dades.</p>"})}},"btn-torneig":{show:[{id:"torneig-buttons",display:"flex"}],action:function(){document.getElementById("content").innerHTML="",fetch("data/modalitat.json").then(e=>e.json()).then(e=>{const t=document.getElementById("torneig-title"),n=Array.isArray(e)?e.map(e=>e.Modalitat).join(", "):e.Modalitat||"";t.textContent=`Social Modalitat ${n}`,t.style.display="block"}).catch(()=>{document.getElementById("torneig-title").style.display="none"})}}};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./service-worker.js").then(e=>{console.log("SW registrat!",e);const t=()=>{e.update().then(()=>{e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"})})};t(),setInterval(t,864e5)}).catch(e=>console.error("Error al registrar el SW:",e));let e=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{e||(window.location.reload(),e=!0)})}),document.getElementById("btn-update").addEventListener("click",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(e=>{e&&e.update().then(()=>{e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"})})})}),document.getElementById("menu").addEventListener("click",e=>{if(e.target.classList.contains("menu-toggle")){const t=document.getElementById(e.target.dataset.target),n="flex"===t.style.display;document.querySelectorAll(".submenu").forEach(e=>e.style.display="none"),t.style.display=n?"none":"flex",m()}}),document.getElementById("submenu-container").addEventListener("click",e=>{const t=p[e.target.id];t&&function(e){m(),document.getElementById("content").style.display="block",(e.show||[]).forEach(({id:e,display:t})=>{const n=document.getElementById(e);n&&(n.style.display=t)}),e.action&&e.action()}(t)}),document.getElementById("torneig-buttons").addEventListener("click",e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.file;fetch(`data/${t}`).then(e=>e.json()).then(e=>l(e,t)).catch(()=>{document.getElementById("content").innerHTML="<p>Error carregant dades.</p>"})}}),document.getElementById("close-chart").addEventListener("click",function(){document.getElementById("chart-overlay").style.display="none";const n=document.getElementById("chart-title");n&&(n.textContent=""),e.lineChart&&(e.lineChart.destroy(),t(null)),o&&(o.focus(),o=null)}),window.addEventListener("resize",function(){const e=document.getElementById("chart-overlay");e&&"none"!==e.style.display&&a()}),Promise.all([fetch("data/ranquing.json").then(e=>e.json()),fetch("data/classificacions.json").then(e=>e.json()).catch(()=>[]),fetch("data/events.json").then(e=>e.json()).catch(()=>[]),fetch("data/calendari.json").then(e=>e.json()).catch(()=>[]),fetch("data/festius.json").then(e=>e.json()).catch(()=>[])]).then(([t,n,a,o,c])=>{e.ranquing=t,e.anys=[...new Set(t.map(e=>parseInt(e.Any,10)))].sort((e,t)=>e-t),e.anySeleccionat=e.anys[e.anys.length-1],e.classificacions=n,e.classYears=[...new Set(n.map(e=>parseInt(e.Any,10)))].sort((e,t)=>e-t),e.classAnySeleccionat=e.classYears[e.classYears.length-1]||null;const d=new Set(n.map(e=>e.Categoria));e.classCategoriaSeleccionada=d.values().next().value||null,e.events=a.map(e=>{const t=e["Títol"]||e.Titol||"";return{...e,"Títol":t,Tipus:t.toLowerCase().includes("assemblea")?"assemblea":"altre"}}).concat(o.map(e=>({Data:e.Data,Hora:"","Títol":`${e["Jugador A"].trim()} vs ${e["Jugador B"].trim()} (${e.Hora})`,Tipus:"partida"}))).concat(c.map(e=>({Data:e.Data,Hora:"","Títol":`Foment tancat (${e.Títol||""})`,Tipus:"festiu"}))),function(){const t=document.getElementById("year-select");t.innerHTML="",e.anys.slice().sort((e,t)=>t-e).forEach(n=>{const a=document.createElement("option");a.value=n,a.textContent=n,n===e.anySeleccionat&&(a.selected=!0),t.appendChild(a)}),t.addEventListener("change",()=>{e.anySeleccionat=parseInt(t.value,10),r()});const n=document.getElementById("modalitat-buttons");n.querySelectorAll("button").forEach(t=>{t.dataset.mod===e.modalitatSeleccionada&&t.classList.add("selected"),t.addEventListener("click",()=>{e.modalitatSeleccionada=t.dataset.mod,n.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),r()})})}(),function(){const t=document.getElementById("classificacio-year-select");t.innerHTML="",e.classYears.slice().sort((e,t)=>t-e).forEach(n=>{const a=document.createElement("option");a.value=n,a.textContent=n,n===e.classAnySeleccionat&&(a.selected=!0),t.appendChild(a)}),t.addEventListener("change",()=>{e.classAnySeleccionat=parseInt(t.value,10),i()});const n=document.getElementById("classificacio-modalitat-buttons");n.querySelectorAll("button").forEach(t=>{t.dataset.mod===e.classModalitatSeleccionada&&t.classList.add("selected"),t.addEventListener("click",()=>{e.classModalitatSeleccionada=t.dataset.mod,n.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),i()})});const a=document.getElementById("categoria-buttons");a.innerHTML="",[...new Set(e.classificacions.map(e=>e.Categoria))].sort().forEach(t=>{const n=document.createElement("button");n.textContent=t,t===e.classCategoriaSeleccionada&&n.classList.add("selected"),n.addEventListener("click",()=>{e.classCategoriaSeleccionada=t,a.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),n.classList.add("selected"),i()}),a.appendChild(n)})}(),document.getElementById("btn-agenda").click()}).catch(e=>{console.error("Error carregant dades",e)});
//# sourceMappingURL=main.js.map
