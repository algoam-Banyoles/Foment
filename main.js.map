{"version":3,"file":"main.js","sources":["src/js/state.js","src/js/graficos.js","src/js/ranking.js","src/js/classificacio.js","src/js/init.js","src/js/torneig.js","src/js/calendari.js","src/js/partides.js","src/js/router.js","src/js/agenda.js","src/js/horari.js","src/js/enllacos.js","src/js/continu3b.js","src/js/install.js","src/js/sw-register.js","src/main.js","src/js/gestioReptes.js"],"sourcesContent":["export const state = {\n  ranquing: [],\n  anys: [],\n  anySeleccionat: null,\n  modalitatSeleccionada: '3 BANDES',\n  lineChart: null,\n  classificacions: [],\n  classYears: [],\n  classAnySeleccionat: null,\n  classModalitatSeleccionada: '3 BANDES',\n  classCategoriaSeleccionada: null,\n  events: [],\n  isAdmin: false,\n  agendaSetmanaInici: (() => {\n    const d = new Date();\n    d.setHours(0, 0, 0, 0);\n    d.setDate(d.getDate() - ((d.getDay() + 6) % 7));\n    return d;\n  })(),\n  torneigModalitat: '',\n  torneigCaramboles: {},\n  torneigCategoriaSeleccionada: null,\n};\n\nexport function setLineChart(chart) {\n  state.lineChart = chart;\n}\n\nexport function appendResponsiveTable(container, table) {\n  const wrapper = document.createElement('div');\n  wrapper.className = 'table-responsive';\n  wrapper.appendChild(table);\n  container.appendChild(wrapper);\n}\n\nexport function adjustChartSize() {\n  const chartContainer = document.getElementById('player-chart');\n  if (chartContainer) {\n    chartContainer.style.width = '90vw';\n    chartContainer.style.height = '96vh';\n  }\n  const canvas = document.getElementById('chart-canvas');\n  if (canvas) {\n    canvas.style.width = '100%';\n    canvas.style.height = '100%';\n  }\n  if (state.lineChart) {\n    state.lineChart.resize();\n  }\n}\n","import { state, setLineChart, adjustChartSize } from './state.js';\n\nlet lastFocusedElement = null;\n\nexport function mostraEvolucioJugador(jugador, nom) {\n  const modalitats = ['3 BANDES', 'BANDA', 'LLIURE'];\n  const dadesPerMod = modalitats.map(mod =>\n    state.ranquing\n      .filter(r => r.Jugador === jugador && r.Modalitat === mod)\n      .map(r => ({ any: parseInt(r.Any, 10), mitjana: parseFloat(r.Mitjana) }))\n      .sort((a, b) => a.any - b.any)\n  );\n\n  const anys = [...new Set(dadesPerMod.flat().map(d => d.any))].sort(\n    (a, b) => a - b\n  );\n\n  const colors = ['blue', 'green', 'red'];\n  const datasets = modalitats.map((mod, idx) => {\n    const values = anys.map(y => {\n      const reg = dadesPerMod[idx].find(d => d.any === y);\n      return reg ? Number.parseFloat(reg.mitjana) : null;\n    });\n    return {\n      label: mod,\n      data: values,\n      borderColor: colors[idx],\n      backgroundColor: colors[idx],\n      tension: 0.2,\n      fill: false,\n    };\n  });\n\n  const canvas = document.getElementById('chart-canvas');\n  const overlay = document.getElementById('chart-overlay');\n  if (overlay) {\n    overlay.style.display = 'flex';\n    lastFocusedElement = document.activeElement;\n  }\n  const closeBtn = document.getElementById('close-chart');\n  if (closeBtn) {\n    closeBtn.focus();\n  }\n  adjustChartSize();\n\n  const title = document.getElementById('chart-title');\n  if (title) {\n    title.textContent = nom;\n  }\n\n  const ctx = canvas.getContext('2d');\n  if (state.lineChart) {\n    state.lineChart.destroy();\n  }\n  setLineChart(new Chart(ctx, {\n    type: 'line',\n    data: {\n      labels: anys,\n      datasets,\n    },\n    options: {\n      plugins: {\n        legend: {\n          position: 'right'\n        }\n      },\n      scales: {\n        x: {\n          title: { display: true, text: 'Any' },\n          ticks: { stepSize: 1, autoSkip: false }\n        },\n        y: {\n          title: { display: true, text: 'Mitjana' },\n          suggestedMin: (() => {\n            const all = datasets.flatMap(d => d.data).filter(v => v != null);\n            const min = all.length ? Math.min(...all) : 0;\n            return Math.floor((min - 0.1) * 10) / 10;\n          })(),\n          suggestedMax: (() => {\n            const all = datasets.flatMap(d => d.data).filter(v => v != null);\n            const max = all.length ? Math.max(...all) : 1;\n            return Math.ceil((max + 0.1) * 10) / 10;\n          })(),\n          ticks: { beginAtZero: false, stepSize: 0.1 }\n\n        }\n      },\n      responsive: true,\n      maintainAspectRatio: false\n    }\n  }));\n}\n\nexport function closeChart() {\n  document.getElementById('chart-overlay').style.display = 'none';\n  const title = document.getElementById('chart-title');\n  if (title) {\n    title.textContent = '';\n  }\n  if (state.lineChart) {\n    state.lineChart.destroy();\n    setLineChart(null);\n  }\n  if (lastFocusedElement) {\n    lastFocusedElement.focus();\n    lastFocusedElement = null;\n  }\n}\n\nexport function handleResize() {\n  const overlay = document.getElementById('chart-overlay');\n  if (overlay && overlay.style.display !== 'none') {\n    adjustChartSize();\n  }\n}\n","import { state, appendResponsiveTable } from './state.js';\nimport { mostraEvolucioJugador } from './graficos.js';\n\nexport function mostraRanquing() {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n  const taula = document.createElement('table');\n  const cap = document.createElement('tr');\n  ['Posició', 'Jugador', 'Mitjana'].forEach(t => {\n    const th = document.createElement('th');\n    th.textContent = t;\n    cap.appendChild(th);\n  });\n  taula.appendChild(cap);\n\n  const dadesOrdenades = state.ranquing\n    .filter(\n      reg =>\n        parseInt(reg.Any, 10) === state.anySeleccionat &&\n        reg.Modalitat === state.modalitatSeleccionada\n    )\n    .sort((a, b) => parseFloat(b.Mitjana) - parseFloat(a.Mitjana));\n\n  dadesOrdenades.forEach((reg, idx) => {\n    const tr = document.createElement('tr');\n    ['Posició', 'Jugador', 'Mitjana'].forEach(clau => {\n      const td = document.createElement('td');\n      let valor;\n      if (clau === 'Posició') {\n        valor = idx + 1;\n      } else if (clau === 'Mitjana') {\n        valor = Number.parseFloat(reg[clau]).toFixed(3);\n      } else {\n        valor = clau === 'Jugador' ? reg.NomComplet : reg[clau];\n      }\n      td.textContent = valor;\n      if (clau === 'Jugador') {\n        td.classList.add('player-cell');\n        td.addEventListener('click', e => {\n          e.stopPropagation();\n          mostraEvolucioJugador(reg.Jugador, reg.NomComplet);\n        });\n      }\n      tr.appendChild(td);\n    });\n    tr.addEventListener('click', () => {\n      mostraEvolucioJugador(reg.Jugador, reg.NomComplet);\n    });\n    taula.appendChild(tr);\n  });\n  appendResponsiveTable(cont, taula);\n}\n","import { state, appendResponsiveTable } from './state.js';\n\nexport function mostraClassificacio() {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n  const taula = document.createElement('table');\n  const cap = document.createElement('tr');\n  ['#', 'Jugador', 'PJ', 'P', 'C', 'E', 'MG', 'MM'].forEach(t => {\n    const th = document.createElement('th');\n    th.textContent = t;\n    cap.appendChild(th);\n  });\n  taula.appendChild(cap);\n\n  const dades = state.classificacions\n    .filter(\n      r =>\n        parseInt(r.Any, 10) === state.classAnySeleccionat &&\n        r.Modalitat === state.classModalitatSeleccionada &&\n        r.Categoria === state.classCategoriaSeleccionada\n    )\n    .sort((a, b) => parseInt(a.Posició, 10) - parseInt(b.Posició, 10));\n\n  dades.forEach(reg => {\n    const tr = document.createElement('tr');\n    const camps = [\n      reg['Posició'],\n      reg['Jugador'] || reg['Nom'] || '',\n      reg['PartidesJugades'] || reg['Partides jugades'] || reg['PJ'] || '',\n      reg['Punts'],\n      reg['Caramboles'],\n      reg['Entrades'],\n      reg['MitjanaGeneral'] || reg['Mitjana'] || '',\n      reg['MitjanaParticular'] || reg['Millor mitjana'] || ''\n    ];\n    camps.forEach((valor, idx) => {\n      const td = document.createElement('td');\n      if (idx >= 6 && valor !== '') {\n        const num = Number.parseFloat(valor);\n        valor = Number.isNaN(num) ? valor : num.toFixed(3);\n      }\n      td.textContent = valor;\n      tr.appendChild(td);\n    });\n    taula.appendChild(tr);\n  });\n  appendResponsiveTable(cont, taula);\n}\n","import { mostraRanquing } from './ranking.js';\nimport { mostraClassificacio } from './classificacio.js';\nimport { state } from './state.js';\n\nconst ADMIN_CODE = window.ADMIN_CODE;\n\nlet adminAttempts = 0;\n\nconst originalFetch = window.fetch.bind(window);\nwindow.fetch = async (url, options = {}) => {\n  const opts = { ...options };\n  if (typeof url === 'string' && url.startsWith('/update-')) {\n    let code = localStorage.getItem('adminCode');\n    if (!code) {\n      code = await promptAdminCode();\n    }\n    opts.headers = { ...(opts.headers || {}), 'X-Admin-Code': code };\n  }\n  const res = await originalFetch(url, opts);\n  if (res.status === 403) {\n    alert(\"Codi d'administrador incorrecte\");\n    localStorage.removeItem('adminCode');\n  }\n  return res;\n};\n\nconst adminBtn = document.getElementById('btn-admin');\nif (adminBtn) {\n  adminBtn.addEventListener('click', async () => {\n    await promptAdminCode();\n  });\n}\n\nexport async function enableAdminFeatures() {\n  state.isAdmin = true;\n  const manageBtn = document.getElementById('btn-gestio-reptes');\n  if (manageBtn) {\n    manageBtn.style.display = '';\n  }\n  if (!window.gestioReptes) {\n    window.gestioReptes = await import('./gestioReptes.js');\n    if (window.gestioReptes.initGestioReptesAdmin) {\n      window.gestioReptes.initGestioReptesAdmin();\n    }\n  }\n}\n\nexport function inicialitza() {\n  Promise.all([\n    fetch('data/ranquing.json').then(r => r.json()),\n    fetch('data/classificacions.json').then(r => r.json()).catch(() => []),\n    fetch('data/events.json').then(r => r.json()).catch(() => []),\n    fetch('data/calendari.json').then(r => r.json()).catch(() => []),\n    fetch('data/festius.json').then(r => r.json()).catch(() => [])\n  ])\n    .then(([dadesRanking, dadesClass, dadesEvents, dadesCalendari, dadesFestius]) => {\n      state.ranquing = dadesRanking;\n      state.anys = [...new Set(dadesRanking.map(d => parseInt(d.Any, 10)))]\n        .sort((a, b) => a - b);\n      state.anySeleccionat = state.anys[state.anys.length - 1];\n\n      state.classificacions = dadesClass;\n      state.classYears = [...new Set(dadesClass.map(d => parseInt(d.Any, 10)))]\n        .sort((a, b) => a - b);\n      state.classAnySeleccionat = state.classYears[state.classYears.length - 1] || null;\n      const categories = new Set(dadesClass.map(d => d.Categoria));\n      state.classCategoriaSeleccionada = categories.values().next().value || null;\n\n      state.events = dadesEvents\n        .map(ev => {\n          const titol = ev['Títol'] || ev['Titol'] || '';\n          return {\n            ...ev,\n            'Títol': titol,\n            Categoria: titol.toLowerCase().includes('assemblea') ? 'assemblea' : 'altre'\n          };\n        })\n        .concat(\n          dadesCalendari.map(p => ({\n            Data: p.Data,\n            Hora: '',\n            Títol: `${p['Jugador A'].trim()} vs ${p['Jugador B'].trim()} (${p.Hora})`,\n            Tipus: '',\n            Categoria: 'partida'\n          }))\n        )\n        .concat(\n          dadesFestius.map(f => ({\n            Data: f.Data,\n            Hora: '',\n            Títol: `Foment tancat (${f.Títol || ''})`,\n            Tipus: '',\n            Categoria: 'festiu'\n          }))\n        );\n\n      preparaSelectors();\n      preparaSelectorsClassificacio();\n      document.getElementById('btn-agenda').click();\n    })\n    .catch(err => {\n      console.error('Error carregant dades', err);\n    });\n}\n\nexport function preparaSelectors() {\n  const select = document.getElementById('year-select');\n  select.innerHTML = '';\n  state.anys.slice().sort((a, b) => b - a).forEach(any => {\n    const opt = document.createElement('option');\n    opt.value = any;\n    opt.textContent = any;\n    if (any === state.anySeleccionat) opt.selected = true;\n    select.appendChild(opt);\n  });\n  select.addEventListener('change', () => {\n    state.anySeleccionat = parseInt(select.value, 10);\n    mostraRanquing();\n  });\n\n  const cont = document.getElementById('modalitat-buttons');\n  cont.querySelectorAll('button').forEach(btn => {\n    if (btn.dataset.mod === state.modalitatSeleccionada) {\n      btn.classList.add('selected');\n    }\n    btn.addEventListener('click', () => {\n      state.modalitatSeleccionada = btn.dataset.mod;\n      cont.querySelectorAll('button').forEach(b => b.classList.remove('selected'));\n      btn.classList.add('selected');\n      mostraRanquing();\n    });\n  });\n}\n\nexport function preparaSelectorsClassificacio() {\n  const yearSel = document.getElementById('classificacio-year-select');\n  yearSel.innerHTML = '';\n  state.classYears.slice().sort((a, b) => b - a).forEach(any => {\n    const opt = document.createElement('option');\n    opt.value = any;\n    opt.textContent = any;\n    if (any === state.classAnySeleccionat) opt.selected = true;\n    yearSel.appendChild(opt);\n  });\n  yearSel.addEventListener('change', () => {\n    state.classAnySeleccionat = parseInt(yearSel.value, 10);\n    mostraClassificacio();\n  });\n\n  const modalBtns = document.getElementById('classificacio-modalitat-buttons');\n  modalBtns.querySelectorAll('button').forEach(btn => {\n    if (btn.dataset.mod === state.classModalitatSeleccionada) {\n      btn.classList.add('selected');\n    }\n    btn.addEventListener('click', () => {\n      state.classModalitatSeleccionada = btn.dataset.mod;\n      modalBtns.querySelectorAll('button').forEach(b => b.classList.remove('selected'));\n      btn.classList.add('selected');\n      mostraClassificacio();\n    });\n  });\n\n  const catBtns = document.getElementById('categoria-buttons');\n  catBtns.innerHTML = '';\n  const cats = [...new Set(state.classificacions.map(c => c.Categoria))].sort();\n  cats.forEach(cat => {\n    const btn = document.createElement('button');\n    btn.textContent = cat;\n    if (cat === state.classCategoriaSeleccionada) btn.classList.add('selected');\n    btn.addEventListener('click', () => {\n      state.classCategoriaSeleccionada = cat;\n      catBtns.querySelectorAll('button').forEach(b => b.classList.remove('selected'));\n      btn.classList.add('selected');\n      mostraClassificacio();\n    });\n    catBtns.appendChild(btn);\n  });\n}\n\nexport function preparaTorneigCategories(categories, render) {\n  const cont = document.getElementById('torneig-category-buttons');\n  cont.innerHTML = '';\n  if (!categories || categories.length === 0) {\n    cont.style.display = 'none';\n    state.torneigCategoriaSeleccionada = null;\n    render();\n    return;\n  }\n  categories.sort();\n  if (!state.torneigCategoriaSeleccionada || !categories.includes(state.torneigCategoriaSeleccionada)) {\n    state.torneigCategoriaSeleccionada = categories[0];\n  }\n  categories.forEach(cat => {\n    const btn = document.createElement('button');\n    btn.textContent = `${cat}a`;\n    if (cat === state.torneigCategoriaSeleccionada) btn.classList.add('selected');\n    btn.addEventListener('click', () => {\n      state.torneigCategoriaSeleccionada = cat;\n      cont.querySelectorAll('button').forEach(b => b.classList.remove('selected'));\n      btn.classList.add('selected');\n      render();\n    });\n    cont.appendChild(btn);\n  });\n  cont.style.display = 'flex';\n  render();\n}\n\nexport function promptAdminCode() {\n  const modal = document.getElementById('admin-modal');\n  const input = document.getElementById('admin-code');\n  const submit = document.getElementById('admin-submit');\n  return new Promise(resolve => {\n    input.value = '';\n    modal.style.display = 'block';\n    const submitHandler = () => {\n      const code = input.value.trim();\n      modal.style.display = 'none';\n      submit.removeEventListener('click', submitHandler);\n      input.removeEventListener('keypress', keyHandler);\n      if (/^[a-zA-Z0-9]{8,12}$/.test(code) && (!ADMIN_CODE || code === ADMIN_CODE)) {\n        alert('Codi correcte');\n        localStorage.setItem('adminCode', code);\n        enableAdminFeatures();\n        if (adminBtn) adminBtn.style.display = 'none';\n        resolve(code);\n      } else {\n        alert('Codi incorrecte');\n        adminAttempts += 1;\n        if (adminAttempts >= 3 && adminBtn) adminBtn.style.display = 'none';\n        resolve(null);\n      }\n    };\n    const keyHandler = e => {\n      if (e.key === 'Enter') submitHandler();\n    };\n    submit.addEventListener('click', submitHandler);\n    input.addEventListener('keypress', keyHandler);\n  });\n}\n","import { preparaTorneigCategories } from './init.js';\nimport { appendResponsiveTable, state } from './state.js';\nimport { mostraCalendari } from './calendari.js';\nimport { mostraPartides } from './partides.js';\n\nexport function mostraTorneig(dades, file) {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n  const catCont = document.getElementById('torneig-category-buttons');\n  catCont.style.display = 'none';\n  catCont.innerHTML = '';\n\n  if (file === 'calendari.json') {\n    mostraCalendari(dades);\n    return;\n  }\n\n  if (file === 'partides.json') {\n    const categories = [...new Set(dades.map(p => p[\"🏆 Categoria de la partida\"]))];\n    preparaTorneigCategories(categories, () => mostraPartides(dades));\n    return;\n  }\n\n  if (!dades) {\n    return;\n  }\n  if (Array.isArray(dades) && dades.length === 0) {\n    const p = document.createElement('p');\n    p.textContent = 'No hi ha dades.';\n    cont.appendChild(p);\n    return;\n  }\n\n  if (\n    file !== 'classificacio.json' &&\n    Array.isArray(dades) &&\n    dades[0] &&\n    (('Categoria jugador' in dades[0] && 'Nom jugador' in dades[0]) ||\n      ('Categoria' in dades[0] && 'Nom' in dades[0]))\n  ) {\n    const catField = 'Categoria jugador' in dades[0] ? 'Categoria jugador' : 'Categoria';\n    const nomField = 'Nom jugador' in dades[0] ? 'Nom jugador' : 'Nom';\n    const agrupats = dades.reduce((acc, reg) => {\n      const cat = reg[catField];\n      if (!acc[cat]) acc[cat] = [];\n      acc[cat].push((reg[nomField] || '').trim());\n      return acc;\n    }, {});\n    const categories = Object.keys(agrupats);\n    const render = () => {\n      cont.innerHTML = '';\n      const cat = state.torneigCategoriaSeleccionada;\n      const h3 = document.createElement('h3');\n      const car = state.torneigCaramboles[cat];\n      h3.textContent = car\n        ? `${cat}a categoria (${car} caramboles)`\n        : `${cat}a categoria`;\n      cont.appendChild(h3);\n      const ul = document.createElement('ul');\n      (agrupats[cat] || []).forEach(nom => {\n        const li = document.createElement('li');\n        li.textContent = nom;\n        ul.appendChild(li);\n      });\n      cont.appendChild(ul);\n    };\n    preparaTorneigCategories(categories, render);\n    return;\n  }\n\n  if (file === 'classificacio.json' && Array.isArray(dades) && dades[0] && 'Posició' in dades[0]) {\n    const agrupats = dades.reduce((acc, reg) => {\n      const cat = reg.Categoria || '';\n      if (!acc[cat]) acc[cat] = [];\n      acc[cat].push(reg);\n      return acc;\n    }, {});\n    const categories = Object.keys(agrupats);\n    const render = () => {\n      cont.innerHTML = '';\n      const cat = state.torneigCategoriaSeleccionada;\n      const h3 = document.createElement('h3');\n      const car = state.torneigCaramboles[cat];\n      h3.textContent = car\n        ? `${cat}a categoria (${car} caramboles)`\n        : `${cat}a categoria`;\n      cont.appendChild(h3);\n      const taula = document.createElement('table');\n      const cap = document.createElement('tr');\n      ['#', 'Jugador', 'PJ', 'P', 'C', 'E', 'MG', 'MM'].forEach(t => {\n        const th = document.createElement('th');\n        th.textContent = t;\n        cap.appendChild(th);\n      });\n      taula.appendChild(cap);\n      (agrupats[cat] || [])\n        .sort((a, b) => {\n          const puntsA = parseInt(a['Punts'], 10) || 0;\n          const puntsB = parseInt(b['Punts'], 10) || 0;\n          if (puntsB !== puntsA) return puntsB - puntsA;\n          const mitjanaA = parseFloat(a['MitjanaGeneral'] || a['Mitjana'] || '0');\n          const mitjanaB = parseFloat(b['MitjanaGeneral'] || b['Mitjana'] || '0');\n          return mitjanaB - mitjanaA;\n        })\n        .forEach((reg, idx) => {\n          const tr = document.createElement('tr');\n          const camps = [\n            idx + 1,\n            reg['Nom'] || '',\n            reg['PartidesJugades'] || reg['Partides jugades'] || reg['PJ'] || '',\n            reg['Punts'],\n            reg['Caramboles'],\n            reg['Entrades'],\n            reg['MitjanaGeneral'] || reg['Mitjana'] || '',\n            reg['MitjanaParticular'] || reg['Millor mitjana'] || ''\n          ];\n          camps.forEach((valor, idx) => {\n            const td = document.createElement('td');\n            if (idx >= 6 && valor !== '') {\n              const num = Number.parseFloat(valor);\n              valor = Number.isNaN(num) ? valor : num.toFixed(3);\n            }\n            td.textContent = valor;\n            tr.appendChild(td);\n          });\n          taula.appendChild(tr);\n        });\n      appendResponsiveTable(cont, taula);\n    };\n    preparaTorneigCategories(categories, render);\n    return;\n  }\n\n  if (Array.isArray(dades) && dades[0] && 'Categoria' in dades[0]) {\n    const agrupats = dades.reduce((acc, reg) => {\n      const cat = reg.Categoria || '';\n      if (!acc[cat]) acc[cat] = [];\n      acc[cat].push(reg);\n      return acc;\n    }, {});\n    const headers = Object.keys(dades[0]).filter(h => h !== 'Categoria');\n    const categories = Object.keys(agrupats);\n    const render = () => {\n      cont.innerHTML = '';\n      const cat = state.torneigCategoriaSeleccionada;\n      const h3 = document.createElement('h3');\n      const car = state.torneigCaramboles[cat];\n      h3.textContent = car\n        ? `${cat}a categoria (${car} caramboles)`\n        : `${cat}a categoria`;\n      cont.appendChild(h3);\n      const taula = document.createElement('table');\n      const cap = document.createElement('tr');\n      headers.forEach(h => {\n        const th = document.createElement('th');\n        th.textContent = h;\n        cap.appendChild(th);\n      });\n      taula.appendChild(cap);\n      (agrupats[cat] || []).forEach(reg => {\n        const tr = document.createElement('tr');\n        headers.forEach(h => {\n          const td = document.createElement('td');\n          td.textContent = reg[h] || '';\n          tr.appendChild(td);\n        });\n        taula.appendChild(tr);\n      });\n      appendResponsiveTable(cont, taula);\n    };\n    preparaTorneigCategories(categories, render);\n    return;\n  }\n\n  if (Array.isArray(dades) && Array.isArray(dades[0])) {\n    const headers = dades[0];\n    const taula = document.createElement('table');\n    const cap = document.createElement('tr');\n    headers.forEach(h => {\n      const th = document.createElement('th');\n      th.textContent = h;\n      cap.appendChild(th);\n    });\n    taula.appendChild(cap);\n    dades.slice(1).forEach(row => {\n      const tr = document.createElement('tr');\n      headers.forEach((_, idx) => {\n        const td = document.createElement('td');\n        td.textContent = row[idx] || '';\n        tr.appendChild(td);\n      });\n      taula.appendChild(tr);\n    });\n    appendResponsiveTable(cont, taula);\n    return;\n  }\n\n  if (Array.isArray(dades) && typeof dades[0] === 'object') {\n    const headers = [...new Set(dades.flatMap(obj => Object.keys(obj)))];\n    const taula = document.createElement('table');\n    const cap = document.createElement('tr');\n    headers.forEach(h => {\n      const th = document.createElement('th');\n      th.textContent = h;\n      cap.appendChild(th);\n    });\n    taula.appendChild(cap);\n    dades.forEach(reg => {\n      const tr = document.createElement('tr');\n      headers.forEach(h => {\n        const td = document.createElement('td');\n        td.textContent = reg[h] || '';\n        tr.appendChild(td);\n      });\n      taula.appendChild(tr);\n    });\n    appendResponsiveTable(cont, taula);\n    return;\n  }\n\n  const pre = document.createElement('pre');\n  pre.textContent = JSON.stringify(dades, null, 2);\n  cont.appendChild(pre);\n}\n","import { appendResponsiveTable } from './state.js';\n\nexport function mostraCalendari(partides) {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n  if (!Array.isArray(partides)) {\n    cont.textContent = 'Dades de calendari no vàlides.';\n    return;\n  }\n  const programades = partides.filter(p => p.Data);\n  const pendents = partides.filter(p => !p.Data);\n\n  programades.sort((a, b) => {\n    const dataDiff = (a.Data || '').localeCompare(b.Data || '');\n    if (dataDiff !== 0) return dataDiff;\n    const horaDiff = (a.Hora || '').localeCompare(b.Hora || '');\n    if (horaDiff !== 0) return horaDiff;\n    const billarA = parseInt((a.Billar || '').match(/\\d+/), 10) || 0;\n    const billarB = parseInt((b.Billar || '').match(/\\d+/), 10) || 0;\n    return billarA - billarB;\n  });\n\n  const filters = document.createElement('div');\n  filters.id = 'calendari-filters';\n  const input = document.createElement('input');\n  input.id = 'calendari-player-filter';\n  input.type = 'text';\n  input.placeholder = 'Filtre Nom Jugador';\n  filters.appendChild(input);\n  cont.appendChild(filters);\n\n  const dataContainer = document.createElement('div');\n  cont.appendChild(dataContainer);\n\n  const mesos = {\n    '01': 'gen',\n    '02': 'feb',\n    '03': 'mar',\n    '04': 'abr',\n    '05': 'mai',\n    '06': 'jun',\n    '07': 'jul',\n    '08': 'ago',\n    '09': 'set',\n    '10': 'oct',\n    '11': 'nov',\n    '12': 'des'\n  };\n\n  function render(filtre = '') {\n    filtre = (filtre || '').toLowerCase();\n    dataContainer.innerHTML = '';\n\n    const progFiltrades = programades.filter(p => {\n      if (!filtre) return true;\n      const j1 = (p['Jugador A'] || '').trim().toLowerCase();\n      const j2 = (p['Jugador B'] || '').trim().toLowerCase();\n      return j1.includes(filtre) || j2.includes(filtre);\n    });\n\n    const dayCounts = progFiltrades.reduce((acc, p) => {\n      acc[p.Data] = (acc[p.Data] || 0) + 1;\n      return acc;\n    }, {});\n\n    const taula = document.createElement('table');\n\n    const cap = document.createElement('tr');\n    ['Data', 'Hora', 'Billar', 'Jugador A', 'Jugador B'].forEach(t => {\n      const th = document.createElement('th');\n      th.textContent = t;\n      cap.appendChild(th);\n    });\n    taula.appendChild(cap);\n\n    let lastData = null;\n    progFiltrades.forEach(p => {\n      const tr = document.createElement('tr');\n      if (p.Data !== lastData) {\n        const tdDia = document.createElement('td');\n        const [yyyy, mm, dd] = (p.Data || '').split('-');\n        const diaNum = parseInt(dd, 10);\n\n        const diaTxt = mm && diaNum ? `${diaNum}<br>${mesos[mm] || mm}` : '';\n        tdDia.innerHTML = diaTxt;\n\n        const count = dayCounts[p.Data];\n        if (count > 1) {\n          tdDia.rowSpan = count;\n          tdDia.classList.add('vertical-text');\n        }\n        tr.appendChild(tdDia);\n        lastData = p.Data;\n      }\n      const billar = (p.Billar || '').replace('Billar ', 'B');\n\n      let hora = p.Hora || '';\n      if (/^\\d{1,2}:00$/.test(hora)) {\n        hora = hora.split(':')[0];\n      }\n\n      [hora, billar, (p['Jugador A'] || '').trim(), (p['Jugador B'] || '').trim()].forEach(val => {\n        const td = document.createElement('td');\n        td.textContent = val;\n        tr.appendChild(td);\n      });\n      taula.appendChild(tr);\n    });\n\n    appendResponsiveTable(dataContainer, taula);\n\n    const pendFiltrades = pendents\n      .filter(p => {\n        if (!filtre) return true;\n        const j1 = (p['Jugador A'] || '').trim().toLowerCase();\n        const j2 = (p['Jugador B'] || '').trim().toLowerCase();\n        return j1.includes(filtre) || j2.includes(filtre);\n      })\n      .sort(\n        (a, b) =>\n          (parseInt(a.Jornada, 10) || 0) - (parseInt(b.Jornada, 10) || 0)\n      );\n\n    if (pendFiltrades.length > 0) {\n      const h3 = document.createElement('h3');\n      h3.textContent = 'Pendent de programar';\n      dataContainer.appendChild(h3);\n\n      const taulaPend = document.createElement('table');\n      const capPend = document.createElement('tr');\n      ['Jornada', 'J1', 'J2'].forEach(t => {\n        const th = document.createElement('th');\n        th.textContent = t;\n        capPend.appendChild(th);\n      });\n      taulaPend.appendChild(capPend);\n\n      pendFiltrades.forEach(p => {\n        const tr = document.createElement('tr');\n        [\n          p.Jornada || '',\n          (p['Jugador A'] || '').trim(),\n          (p['Jugador B'] || '').trim()\n        ].forEach(val => {\n          const td = document.createElement('td');\n          td.textContent = val;\n          tr.appendChild(td);\n        });\n        taulaPend.appendChild(tr);\n      });\n\n      appendResponsiveTable(dataContainer, taulaPend);\n    }\n  }\n\n  input.addEventListener('input', () => {\n    render(input.value.trim().toLowerCase());\n  });\n\n  render();\n}\n","import { appendResponsiveTable, state } from './state.js';\n\nexport function mostraPartides(partides) {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n  if (!Array.isArray(partides)) {\n    cont.textContent = 'Dades de partides no vàlides.';\n    return;\n  }\n\n  partides.sort((a, b) => {\n    const dateA = new Date(a.Timestamp);\n    const dateB = new Date(b.Timestamp);\n    return dateB - dateA;\n  });\n\n  const filters = document.createElement('div');\n  filters.id = 'partides-filters';\n\n  const input = document.createElement('input');\n  input.id = 'partides-player-filter';\n  input.type = 'text';\n  input.placeholder = 'Filtre Nom Jugador';\n  filters.appendChild(input);\n\n  cont.appendChild(filters);\n\n  const list = document.createElement('div');\n  cont.appendChild(list);\n\n  function render(filtre = '') {\n    filtre = (filtre || '').toLowerCase();\n    list.innerHTML = '';\n    const filtered = partides\n      .filter(p => p[\"🏆 Categoria de la partida\"] === state.torneigCategoriaSeleccionada)\n      .filter(p => {\n        if (!filtre) return true;\n        const nom1 = (p[\"🎱 Nom del Jugador 1\"] || '').trim().toLowerCase();\n        const nom2 = (p[\"🎱 Nom del Jugador 2\"] || '').trim().toLowerCase();\n        return nom1.includes(filtre) || nom2.includes(filtre);\n      });\n\n    filtered.forEach((p, idx) => {\n      const nom1 = (p[\"🎱 Nom del Jugador 1\"] || '').trim();\n      const nom2 = (p[\"🎱 Nom del Jugador 2\"] || '').trim();\n      const car1 = parseInt(p[\"🔢 Caramboles del Jugador 1\"], 10) || 0;\n      const car2 = parseInt(p[\"🔢 Caramboles del Jugador 2\"], 10) || 0;\n      const entrades = p[\"⏱️ Entrades de la partida\"] || '';\n      const mitj1 = (parseFloat(p[\"Mitjana J1\"]) || 0).toFixed(3);\n      const mitj2 = (parseFloat(p[\"Mitjana J2\"]) || 0).toFixed(3);\n      const emoji1 = car1 > car2 ? ' 🏆' : '';\n      const emoji2 = car2 > car1 ? ' 🏆' : '';\n\n      const table = document.createElement('table');\n      table.className = 'partida';\n\n      const colgroup = document.createElement('colgroup');\n      ['jugadors', 'c', 'e', 'm'].forEach(cl => {\n        const col = document.createElement('col');\n        col.className = cl;\n        colgroup.appendChild(col);\n      });\n      table.appendChild(colgroup);\n\n      if (idx === 0) {\n        const thead = document.createElement('thead');\n        const headerRow = document.createElement('tr');\n        ['Jugadors', 'C', 'E', 'M'].forEach(text => {\n          const th = document.createElement('th');\n          th.textContent = text;\n          headerRow.appendChild(th);\n        });\n        thead.appendChild(headerRow);\n        table.appendChild(thead);\n      }\n\n      const tbody = document.createElement('tbody');\n      const tr1 = document.createElement('tr');\n      const tr2 = document.createElement('tr');\n\n      const tdNom1 = document.createElement('td');\n      tdNom1.textContent = `${nom1}${emoji1}`;\n      const tdCar1 = document.createElement('td');\n      tdCar1.textContent = car1;\n      const tdEntr = document.createElement('td');\n      tdEntr.textContent = entrades;\n      tdEntr.rowSpan = 2;\n      const tdMitj1 = document.createElement('td');\n      tdMitj1.textContent = mitj1;\n\n      tr1.appendChild(tdNom1);\n      tr1.appendChild(tdCar1);\n      tr1.appendChild(tdEntr);\n      tr1.appendChild(tdMitj1);\n\n      const tdNom2 = document.createElement('td');\n      tdNom2.textContent = `${nom2}${emoji2}`;\n      const tdCar2 = document.createElement('td');\n      tdCar2.textContent = car2;\n      const tdMitj2 = document.createElement('td');\n      tdMitj2.textContent = mitj2;\n\n      tr2.appendChild(tdNom2);\n      tr2.appendChild(tdCar2);\n      tr2.appendChild(tdMitj2);\n\n      tbody.appendChild(tr1);\n      tbody.appendChild(tr2);\n      table.appendChild(tbody);\n      appendResponsiveTable(list, table);\n    });\n  }\n\n  input.addEventListener('input', () => {\n    render(input.value.trim().toLowerCase());\n  });\n\n  render();\n}\n","import { mostraRanquing } from './ranking.js';\nimport { mostraClassificacio } from './classificacio.js';\nimport { mostraAgenda } from './agenda.js';\nimport { mostraHorari } from './horari.js';\nimport { mostraEnllacos } from './enllacos.js';\nimport { mostraContinu3B } from './continu3b.js';\nimport { mostraTorneig } from './torneig.js';\n\n  const uiSections = [\n    'filters-row',\n    'classificacio-filters',\n    'torneig-buttons',\n    'torneig-title',\n    'torneig-category-buttons',\n    'continu3b-buttons',\n    'campionats-disclaimer',\n    'content'\n  ];\n\nfunction hideAll() {\n  uiSections.forEach(id => {\n    const el = document.getElementById(id);\n    if (el) el.style.display = 'none';\n  });\n}\n\nfunction loadTorneig() {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n  fetch('data/modalitat.json')\n    .then(r => r.json())\n    .then(d => {\n      const title = document.getElementById('torneig-title');\n      const text = Array.isArray(d)\n        ? d.map(m => m.Modalitat).join(', ')\n        : (d.Modalitat || '');\n      title.textContent = `Social Modalitat ${text}`;\n      title.style.display = 'block';\n    })\n    .catch(() => {\n      document.getElementById('torneig-title').style.display = 'none';\n    });\n}\n\nconst routes = {\n  'btn-ranking': {\n    show: [{ id: 'filters-row', display: 'flex' }],\n    action: mostraRanquing\n  },\n  'btn-classificacio': {\n    show: [{ id: 'classificacio-filters', display: 'flex' }],\n    action: mostraClassificacio\n  },\n  'btn-agenda': { action: mostraAgenda },\n  'btn-horari': { action: mostraHorari },\n  'btn-enllacos': { action: mostraEnllacos },\n  'btn-continu3b': {\n    show: [\n      { id: 'continu3b-buttons', display: 'flex' },\n      { id: 'campionats-disclaimer', display: 'block' }\n    ],\n    action: mostraContinu3B\n  },\n  'btn-torneig': {\n    show: [\n      { id: 'torneig-buttons', display: 'flex' },\n      { id: 'campionats-disclaimer', display: 'block' }\n    ],\n    action: loadTorneig\n  }\n};\n\nfunction handleRoute(route) {\n  hideAll();\n  const content = document.getElementById('content');\n  content.style.display = 'block';\n  (route.show || []).forEach(({ id, display }) => {\n    const el = document.getElementById(id);\n    if (el) el.style.display = display;\n  });\n  if (route.action) route.action();\n}\n\nexport function setupRouter() {\n  document.getElementById('menu').addEventListener('click', e => {\n    if (e.target.classList.contains('menu-toggle')) {\n      const target = document.getElementById(e.target.dataset.target);\n      const isVisible = target.style.display === 'flex';\n      document.querySelectorAll('.submenu').forEach(sm => (sm.style.display = 'none'));\n      target.style.display = isVisible ? 'none' : 'flex';\n      hideAll();\n    }\n  });\n\n  document.getElementById('submenu-container').addEventListener('click', e => {\n    const route = routes[e.target.id];\n    if (route) {\n      handleRoute(route);\n    }\n  });\n\n  document.getElementById('torneig-buttons').addEventListener('click', e => {\n    if (e.target.tagName === 'BUTTON') {\n      const file = e.target.dataset.file;\n      fetch(`data/${file}`)\n        .then(r => r.json())\n        .then(d => mostraTorneig(d, file))\n        .catch(() => {\n          document.getElementById('content').innerHTML = '<p>Error carregant dades.</p>';\n        });\n    }\n  });\n}\n\n","import { state, appendResponsiveTable } from './state.js';\n\nexport function mostraAgenda() {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n  const calContainer = document.createElement('div');\n  calContainer.id = 'calendar-container';\n  const nav = document.createElement('div');\n  nav.className = 'calendar-nav';\n  const prev = document.createElement('button');\n  prev.textContent = '<';\n  const next = document.createElement('button');\n  next.textContent = '>';\n  const label = document.createElement('span');\n  label.id = 'calendar-month';\n  prev.addEventListener('click', () => {\n    state.agendaSetmanaInici.setDate(state.agendaSetmanaInici.getDate() - 7);\n    render();\n  });\n  next.addEventListener('click', () => {\n    state.agendaSetmanaInici.setDate(state.agendaSetmanaInici.getDate() + 7);\n    render();\n  });\n  nav.appendChild(prev);\n  nav.appendChild(label);\n  nav.appendChild(next);\n  calContainer.appendChild(nav);\n  const calTable = document.createElement('table');\n  calTable.className = 'calendar-table';\n  const headRow = document.createElement('tr');\n  ['Dl', 'Dt', 'Dc', 'Dj', 'Dv', 'Ds', 'Dg'].forEach(d => {\n    const th = document.createElement('th');\n    th.textContent = d;\n    headRow.appendChild(th);\n  });\n  calTable.appendChild(headRow);\n  const calBody = document.createElement('tbody');\n  calTable.appendChild(calBody);\n  appendResponsiveTable(calContainer, calTable);\n  cont.appendChild(calContainer);\n  const listTable = document.createElement('table');\n  listTable.id = 'event-list';\n  listTable.classList.add('agenda-table');\n  appendResponsiveTable(cont, listTable);\n\n  const today = new Date();\n  let selectedDate = new Date(Date.UTC(today.getFullYear(), today.getMonth(), today.getDate()))\n    .toISOString()\n    .split('T')[0];\n\n  function renderCalendar() {\n    calBody.innerHTML = '';\n    const row = document.createElement('tr');\n    for (let i = 0; i < 7; i++) {\n      const cell = document.createElement('td');\n      const date = new Date(state.agendaSetmanaInici);\n      date.setDate(state.agendaSetmanaInici.getDate() + i);\n      const iso = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()))\n        .toISOString()\n        .split('T')[0];\n      cell.textContent = date.getDate();\n      cell.dataset.date = iso;\n      const dayEvents = state.events.filter(ev => ev['Data'] === iso);\n      if (dayEvents.length > 0) {\n        let cls = 'event-other';\n        if (dayEvents.some(ev => ev.Categoria === 'festiu')) {\n          cls = 'event-festiu';\n        } else if (dayEvents.some(ev => ev.Categoria === 'assemblea')) {\n          cls = 'event-assemblea';\n        } else if (dayEvents.some(ev => ev.Categoria === 'partida')) {\n          cls = 'event-partida';\n        } else if (dayEvents.some(ev => ev['Títol'].includes('Fi'))) {\n          cls = 'event-fi';\n        } else if (dayEvents.some(ev => ev['Títol'].includes('Inici'))) {\n          cls = 'event-inici';\n        }\n        cell.classList.add(cls);\n      }\n      if (iso === selectedDate) {\n        cell.classList.add('selected-day');\n      }\n      cell.addEventListener('click', () => {\n        selectedDate = iso;\n        render();\n      });\n      row.appendChild(cell);\n    }\n    calBody.appendChild(row);\n  }\n\n  function renderList() {\n    listTable.innerHTML = '';\n    const header = document.createElement('tr');\n    ['Data', 'Títol'].forEach(t => {\n      const th = document.createElement('th');\n      th.textContent = t;\n      header.appendChild(th);\n    });\n    listTable.appendChild(header);\n    const dayEvents = state.events\n      .filter(ev => ev['Data'] === selectedDate)\n      .sort((a, b) => (a['Hora'] || '').localeCompare(b['Hora'] || ''));\n    dayEvents.forEach(ev => {\n      const tr = document.createElement('tr');\n      tr.dataset.date = ev['Data'];\n      let cls = 'event-other';\n      if (ev.Categoria === 'festiu') {\n        cls = 'event-festiu';\n      } else if (ev.Categoria === 'assemblea') {\n        cls = 'event-assemblea';\n      } else if (ev.Categoria === 'partida') {\n        cls = 'event-partida';\n      } else if (ev['Títol'].includes('Fi')) {\n        cls = 'event-fi';\n      } else if (ev['Títol'].includes('Inici')) {\n        cls = 'event-inici';\n      }\n      tr.classList.add(cls);\n      ['Data', 'Títol'].forEach(clau => {\n        const td = document.createElement('td');\n        if (clau === 'Data') {\n          const [y, m, d] = (ev['Data'] || '').split('-');\n          td.textContent = `${d}/${m}`;\n        } else {\n          const text = ev[clau] || '';\n\n          const tipus = (ev.Tipus || '').toLowerCase();\n\n          if (tipus === 'confirmat') {\n            td.innerHTML = `<strong>${text}</strong>`;\n          } else if (tipus === 'previsió' || tipus === 'previsio') {\n            td.innerHTML = `<em>${text} (previsió)</em>`;\n          } else {\n            td.textContent = text;\n          }\n        }\n        tr.appendChild(td);\n      });\n      listTable.appendChild(tr);\n    });\n  }\n\n  function render() {\n    const end = new Date(state.agendaSetmanaInici);\n    end.setDate(state.agendaSetmanaInici.getDate() + 6);\n    const weekEnd = new Date(state.agendaSetmanaInici);\n    weekEnd.setDate(state.agendaSetmanaInici.getDate() + 7);\n    if (new Date(selectedDate) < state.agendaSetmanaInici || new Date(selectedDate) >= weekEnd) {\n      selectedDate = state.agendaSetmanaInici.toISOString().split('T')[0];\n    }\n    const startStr = state.agendaSetmanaInici.toLocaleDateString('ca-ES', { day: 'numeric', month: 'short' });\n    const endStr = end.toLocaleDateString('ca-ES', { day: 'numeric', month: 'short', year: 'numeric' });\n    label.textContent = `${startStr} - ${endStr}`;\n    renderCalendar();\n    renderList();\n  }\n\n  render();\n}\n","export function mostraHorari() {\n  const cont = document.getElementById('content');\n  cont.innerHTML = `\n<div class=\"normes-container\">\n  <h2 class=\"normes-title\">Normes d’ús i horari</h2>\n\n  <!-- Horari -->\n  <div class=\"normes-card horari\">\n    <h3>🕒 Horari d'obertura de la Secció</h3>\n    <ul>\n      <li><b>Dilluns, dimecres, dijous, dissabte i diumenge:</b> 9:00 – 21:30</li>\n      <li><b>Dimarts i divendres:</b> 10:30 – 21:30</li>\n      <li>L'horari d'obertura pot canviar en funció dels horaris d'obertura del <b>Bar del Foment</b>.</li>\n      <li>L'horari d'atenció al públic del <b>FOMENT</b> és de <b>DILLUNS A DIVENDRES</b> de <b>9:00 A 13:00</b> i de <b>16:00 A 20:00</b>.</li>\n      <li>Les seccions poden tenir activitat fora d'aquest horari si el bar està obert, excepte <b>AGOST</b> i <b>FESTIUS</b>, quan el <b>FOMENT</b> resta oficialment tancat.</li>\n      <li>La secció romandrà tancada els dies de <b>TANCAMENT OFICIAL</b> del <b>FOMENT</b>.</li>\n\n    </ul>\n  </div>\n\n  <!-- Norma Obligatòria -->\n  <div class=\"normes-card obligatori\">\n    <h3>🚨 OBLIGATORI</h3>\n    <p class=\"obligatori-text\">\n      Netejar el billar i les boles abans de començar cada partida amb el material que la Secció posa a disposició de tots els socis.\n    </p>\n  </div>\n\n  <!-- Prohibicions -->\n  <div class=\"normes-card prohibit\">\n\n    <h3>🚫 PROHIBIT</h3>\n\n    <ul>\n      <li>Jugar a fantasia.</li>\n      <li>Menjar mentre s'està jugant.</li>\n      <li>Posar begudes sobre cap element del billar.</li>\n    </ul>\n  </div>\n\n  <!-- Inscripció -->\n  <div class=\"normes-card\">\n    <h3>📝 Inscripció a les partides</h3>\n    <ul>\n      <li>Apunta’t a la pissarra única de <b>PARTIDES SOCIALS</b>.</li>\n      <li>Els companys no cal que s’apuntin; si ho fan, que sigui al costat del primer jugador.</li>\n    </ul>\n  </div>\n\n  <!-- Assignació de taula -->\n  <div class=\"normes-card\">\n    <h3>🗂 Assignació de taula</h3>\n    <ul>\n      <li>Quan hi hagi una taula lliure, ratlla el teu nom i juga.</li>\n      <li>Si vols una taula concreta ocupada, <b>passa el torn</b> fins que s’alliberi.</li>\n    </ul>\n  </div>\n\n  <!-- Temps de joc -->\n  <div class=\"normes-card\">\n    <h3>⏳ Temps de joc</h3>\n    <ul>\n      <li>Màxim <b>1 hora</b> per partida (sol o en grup).</li>\n      <li><b>PROHIBIT</b> posar monedes per allargar el temps, encara que hi hagi taules lliures.</li>\n    </ul>\n  </div>\n\n  <!-- Tornar a jugar -->\n  <div class=\"normes-card\">\n    <h3>🔄 Tornar a jugar</h3>\n    <ul>\n      <li>Només pots repetir si <b>no hi ha ningú apuntat</b> i hi ha una taula lliure.</li>\n    </ul>\n  </div>\n</div>\n  `;\n}\n","export function mostraEnllacos() {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n  fetch('data/enllacos.json')\n    .then(r => r.json())\n    .then(d => {\n      const tipusMap = {};\n      d.forEach(item => {\n        const tipus = item.Tipus || 'Altres';\n        if (!tipusMap[tipus]) tipusMap[tipus] = [];\n        tipusMap[tipus].push(item);\n      });\n\n      Object.entries(tipusMap).forEach(([tipus, items]) => {\n        const tipusDetails = document.createElement('details');\n        const tipusSummary = document.createElement('summary');\n        tipusSummary.textContent = tipus;\n        tipusSummary.classList.add('enllac-tipus');\n        tipusDetails.appendChild(tipusSummary);\n\n        items.forEach(ci => {\n          const url = ci.URL || ci.Url || ci.url;\n          if (url) {\n            const ul = tipusDetails.querySelector('ul') || document.createElement('ul');\n            const li = document.createElement('li');\n            const a = document.createElement('a');\n            a.href = url;\n            a.target = '_blank';\n            a.rel = 'noopener';\n            let text =\n              ci.Títol ||\n              ci.Titol ||\n              ci.Nom ||\n              ci.Name ||\n              ci.Text ||\n              url;\n            if (ci.Billar) text += ` - Billar ${ci.Billar}`;\n            a.textContent = text;\n            li.appendChild(a);\n            ul.appendChild(li);\n            tipusDetails.appendChild(ul);\n          }\n        });\n\n        cont.appendChild(tipusDetails);\n      });\n    })\n    .catch(err => {\n      cont.textContent = \"No s'han pogut carregar els enllaços.\";\n      console.error('Error loading links', err);\n    });\n}\n","import { appendResponsiveTable, state } from './state.js';\n\nexport function mostraContinu3B() {\n  const cont = document.getElementById('content');\n  cont.innerHTML = '';\n\n  const btnContainer = document.getElementById('continu3b-buttons');\n  btnContainer.innerHTML = '';\n\n\n  Promise.all([\n    fetch('data/continu3b_rankingactiu.json').then(r => r.json()).catch(() => []),\n    fetch('data/continu3b_llistaespera.json').then(r => r.json()).catch(() => []),\n    fetch('data/continu3b_reptes.json').then(r => r.json()).catch(() => []),\n    fetch('data/continu3b_partides.json').then(r => r.json()).catch(() => []),\n    fetch('data/continu3b_jugadors.json').then(r => r.json()).catch(() => [])\n  ])\n    .then(([ranking, llista, reptes, partides, jugadors]) => {\n\n      const mapJugadors = Object.fromEntries(jugadors.map(j => [j.id, j.nom]));\n\n      function mostraPartidesJugador(id, nom) {\n        cont.innerHTML = '';\n        const title = document.createElement('h3');\n        title.textContent = `Partides de ${nom}`;\n        cont.appendChild(title);\n        const partJug = partides.filter(\n          p => p.local_id === id || p.visitant_id === id\n        );\n        if (partJug.length) {\n          const table = document.createElement('table');\n          const thead = document.createElement('thead');\n          const headerRow = document.createElement('tr');\n          ['Data', 'Rival', 'Resultat'].forEach(h => {\n            const th = document.createElement('th');\n            th.textContent = h;\n            headerRow.appendChild(th);\n          });\n          thead.appendChild(headerRow);\n          table.appendChild(thead);\n          const tbody = document.createElement('tbody');\n          partJug.forEach(p => {\n            const tr = document.createElement('tr');\n            const data = p.data\n              ? new Date(p.data).toLocaleDateString('ca-ES')\n              : '';\n            const esLocal = p.local_id === id;\n            const rivalId = esLocal ? p.visitant_id : p.local_id;\n            const rival = mapJugadors[rivalId] || rivalId;\n            const resultat =\n              p.caramboles_local && p.caramboles_visitant\n                ? esLocal\n                  ? `${p.caramboles_local}-${p.caramboles_visitant}`\n                  : `${p.caramboles_visitant}-${p.caramboles_local}`\n                : '';\n            [data, rival, resultat].forEach(t => {\n              const td = document.createElement('td');\n              td.textContent = t;\n              tr.appendChild(td);\n            });\n            tbody.appendChild(tr);\n          });\n          table.appendChild(tbody);\n          appendResponsiveTable(cont, table);\n        } else {\n          const p = document.createElement('p');\n          p.textContent = 'No hi ha partides per aquest jugador.';\n          cont.appendChild(p);\n        }\n        const backBtn = document.createElement('button');\n        backBtn.textContent = 'Torna';\n        backBtn.addEventListener('click', () => btnRanking.click());\n        cont.appendChild(backBtn);\n      }\n\n      const showSection = (btn, render) => {\n        btnContainer.querySelectorAll('button').forEach(b =>\n          b.classList.remove('selected')\n        );\n        btn.classList.add('selected');\n        cont.innerHTML = '';\n        render();\n      };\n\n      const filterLabel = document.createElement('label');\n      filterLabel.id = 'ranking-filter-disponibles';\n      const chkDisponibles = document.createElement('input');\n      chkDisponibles.type = 'checkbox';\n      filterLabel.appendChild(chkDisponibles);\n      filterLabel.appendChild(\n        document.createTextNode(' Mostra només disponibles')\n      );\n\n      const btnRanking = document.createElement('button');\n      btnRanking.textContent = 'Rànquing actual';\n      chkDisponibles.addEventListener('change', () => btnRanking.click());\n      btnRanking.addEventListener('click', () =>\n        showSection(btnRanking, () => {\n          const title = document.createElement('h3');\n          title.textContent = 'Rànquing actual';\n          cont.appendChild(title);\n          if (Array.isArray(ranking) && ranking.length) {\n              const table = document.createElement('table');\n              table.classList.add('ranking-table');\n            const thead = document.createElement('thead');\n            const headerRow = document.createElement('tr');\n\n            [\n              'Posició',\n              'Jugador',\n              'Pot reptar',\n              'Pot ser reptat',\n\n              'Motiu',\n              'Termini per nou repte'\n\n            ].forEach(h => {\n              const th = document.createElement('th');\n              th.textContent = h;\n              headerRow.appendChild(th);\n            });\n            thead.appendChild(headerRow);\n            table.appendChild(thead);\n\n            const tbody = document.createElement('tbody');\n            const ordered = ranking\n              .slice()\n              .sort((a, b) => parseInt(a.posicio) - parseInt(b.posicio));\n            ordered.forEach(r => {\n                const info = jugadors.find(j => j.id === r.jugador_id) || {};\n                const potReptar = info.pot_reptar === 'OK';\n                const potSerReptat = info.pot_ser_reptat === 'OK';\n\n                const motiuRaw = info.eligibility_reptar_motiu;\n                let motiuText = '';\n                let terminiText = '';\n                if (motiuRaw && motiuRaw !== 'NOW') {\n                  const match = motiuRaw.match(/^(\\w+)(?:\\((\\d+)\\))?$/);\n                  if (match) {\n                    const motiuMap = { ACCEPTED: 'Repte actiu' };\n                    motiuText = motiuMap[match[1]] || match[1];\n                    if (match[2]) {\n                      const dies = parseInt(match[2], 10);\n                      terminiText = `${dies} ${dies === 1 ? 'dia' : 'dies'}`;\n                    }\n                  } else {\n                    motiuText = motiuRaw;\n                  }\n                }\n\n                const pot = potReptar && potSerReptat;\n                if (chkDisponibles.checked && !pot) return;\n\n                const tr = document.createElement('tr');\n\n                const posTd = document.createElement('td');\n                posTd.textContent = r.posicio;\n\n                posTd.classList.add('ranking-pos');\n\n                tr.appendChild(posTd);\n\n                const nom = mapJugadors[r.jugador_id] || r.jugador_id;\n                const nameBtn = document.createElement('button');\n                nameBtn.textContent = nom;\n                nameBtn.addEventListener('click', () =>\n                  mostraPartidesJugador(r.jugador_id, nom)\n                );\n                const nomTd = document.createElement('td');\n                nomTd.classList.add('ranking-name');\n                nomTd.appendChild(nameBtn);\n                tr.appendChild(nomTd);\n\n                const reptarTd = document.createElement('td');\n                const reptarSpan = document.createElement('span');\n                reptarSpan.textContent = potReptar ? '🟢' : '🔴';\n                reptarSpan.title = potReptar\n                  ? 'Pot reptar'\n                  : 'No pot reptar';\n                reptarTd.dataset.label = 'Pot reptar';\n                reptarTd.appendChild(reptarSpan);\n                tr.appendChild(reptarTd);\n\n                const serTd = document.createElement('td');\n                const serSpan = document.createElement('span');\n                serSpan.textContent = potSerReptat ? '🟢' : '🔴';\n                serSpan.title = potSerReptat\n                  ? 'Pot ser reptat'\n                  : 'No pot ser reptat';\n                serTd.dataset.label = 'Pot ser reptat';\n                serTd.appendChild(serSpan);\n                tr.appendChild(serTd);\n\n                const motiuTd = document.createElement('td');\n                motiuTd.dataset.label = 'Motiu';\n\n                motiuTd.textContent = motiuText;\n                tr.appendChild(motiuTd);\n\n                const terminiTd = document.createElement('td');\n                terminiTd.dataset.label = 'Termini per nou repte';\n                terminiTd.textContent = terminiText;\n                tr.appendChild(terminiTd);\n\n\n                tbody.appendChild(tr);\n              });\n            table.appendChild(tbody);\n            const legenda = document.createElement('div');\n\n            ['🟢 Sí', '🔴 No'].forEach(t => {\n                const p = document.createElement('p');\n                p.textContent = t;\n                legenda.appendChild(p);\n              });\n\n            cont.appendChild(legenda);\n            cont.appendChild(filterLabel);\n            appendResponsiveTable(cont, table);\n          } else {\n\n            const p = document.createElement('p');\n            p.textContent = 'No hi ha rànquing disponible.';\n            cont.appendChild(p);\n          }\n        })\n      );\n\n      const renderReptes = (titleText, filterFn) => {\n        const reptesFiltrats = reptes.filter(filterFn);\n        const reptesPendents = reptesFiltrats.filter(r => r.estat === 'proposat');\n        const reptesAcceptats = reptesFiltrats.filter(r => r.estat === 'acceptat');\n        const reptesProgramats = reptesFiltrats.filter(r => r.estat === 'programat');\n        const reptesTancats = reptesFiltrats.filter(r => r.estat === 'tancat');\n\n        const title = document.createElement('h3');\n        title.textContent = titleText;\n        cont.appendChild(title);\n\n        const drawCards = (list, infoFn, container = cont) => {\n          list.forEach(r => {\n            const card = document.createElement('div');\n            card.classList.add('repte-card');\n            const reptador = mapJugadors[r.reptador_id] || r.reptador_id;\n            const reptat = mapJugadors[r.reptat_id] || r.reptat_id;\n            const h4 = document.createElement('h4');\n            h4.textContent = `${reptador} vs ${reptat}`;\n            card.appendChild(h4);\n\n            const info = infoFn(r);\n            info.forEach(([label, value]) => {\n              if (value) {\n                const p = document.createElement('p');\n                const d = new Date(value);\n                p.textContent = `${label}: ${\n                  !isNaN(d) ? d.toLocaleDateString('ca-ES') : value\n                }`;\n                card.appendChild(p);\n              }\n            });\n\n            container.appendChild(card);\n          });\n        };\n\n        const section = (t, list, infoFn, emptyMsg) => {\n          const st = document.createElement('h4');\n          st.textContent = t;\n          cont.appendChild(st);\n          if (list.length) {\n            drawCards(list, infoFn);\n          } else {\n            const p = document.createElement('p');\n            p.textContent = emptyMsg;\n            cont.appendChild(p);\n          }\n        };\n\n        const calcLimit = base =>\n          base ? new Date(new Date(base).getTime() + 7 * 24 * 60 * 60 * 1000) : null;\n\n        const infoPendents = r => {\n          const limitAcceptar = calcLimit(r.created_at);\n          const limitJugar = calcLimit(limitAcceptar);\n          return [\n            ['Creació', r.created_at],\n            ['Límit acceptar', limitAcceptar],\n            ['Límit jugar', limitJugar]\n          ];\n        };\n\n        const infoAcceptats = r => [\n          ['Creació', r.created_at],\n          ['Acceptació', r.data_acceptacio],\n          ['Límit jugar', calcLimit(r.data_acceptacio || r.created_at)]\n        ];\n\n        const infoProgramats = r => [\n          ['Creació', r.created_at],\n          ['Acceptació', r.data_acceptacio],\n          ['Programació', r.data_programa],\n          ['Límit jugar', calcLimit(r.data_acceptacio || r.created_at)]\n        ];\n\n        const mapPartides = Object.fromEntries(partides.map(p => [p.id, p]));\n\n        const motiusMap = {\n          REFUS: 'Refús',\n          INCOMPAREIXENCA: 'Incompareixença',\n          RESULTAT: 'Resultat'\n        };\n\n        const infoTancats = r => {\n          const partida = mapPartides[r.partida_id] || {};\n          const motiu =\n            !partida.data && r.resultat_motiu\n              ? motiusMap[r.resultat_motiu] || r.resultat_motiu\n              : null;\n          return [\n            ['Creació', r.created_at],\n            ['Acceptació', r.data_acceptacio],\n            ['Programació', r.data_programa],\n            ['Jugat', partida.data],\n            ['Motiu tancament', motiu]\n          ];\n        };\n\n        section(\n          'Pendents d’acceptar',\n          reptesPendents,\n          infoPendents,\n          'No hi ha reptes pendents.'\n        );\n        section(\n          'Acceptats',\n          reptesAcceptats,\n          infoAcceptats,\n          'No hi ha reptes acceptats.'\n        );\n        section(\n          'Programats',\n          reptesProgramats,\n          infoProgramats,\n          'No hi ha reptes programats.'\n        );\n\n        const detTancats = document.createElement('details');\n        detTancats.id = 'reptes-tancats';\n        const sumTancats = document.createElement('summary');\n        sumTancats.textContent = 'Tancats';\n        detTancats.appendChild(sumTancats);\n        if (reptesTancats.length) {\n          drawCards(reptesTancats, infoTancats, detTancats);\n        } else {\n          const p = document.createElement('p');\n          p.textContent = 'No hi ha reptes tancats.';\n          detTancats.appendChild(p);\n        }\n        cont.appendChild(detTancats);\n      };\n\n      const btnReptes = document.createElement('button');\n      btnReptes.textContent = 'Reptes';\n      btnReptes.addEventListener('click', () =>\n        showSection(btnReptes, () =>\n          renderReptes('Reptes', r => r.tipus !== 'acces')\n        )\n      );\n\n      const btnLlista = document.createElement('button');\n      btnLlista.textContent = \"Llista d'espera\";\n      btnLlista.addEventListener('click', () =>\n        showSection(btnLlista, () => {\n          const title = document.createElement('h3');\n          title.textContent = \"Llista d'espera\";\n          cont.appendChild(title);\n          if (Array.isArray(llista) && llista.length) {\n            const table = document.createElement('table');\n            // Usa el mateix estil del rànquing actiu però sense els colors de medalla\n            table.classList.add('ranking-table', 'no-medals');\n            const thead = document.createElement('thead');\n            const headerRow = document.createElement('tr');\n            ['Posició', 'Jugador', 'Pot reptar'].forEach(h => {\n              const th = document.createElement('th');\n              th.textContent = h;\n              headerRow.appendChild(th);\n            });\n            thead.appendChild(headerRow);\n            table.appendChild(thead);\n\n            const tbody = document.createElement('tbody');\n            const ordered = llista\n              .slice()\n              .sort((a, b) => parseInt(a.ordre, 10) - parseInt(b.ordre, 10));\n            ordered.forEach((l, idx) => {\n              const tr = document.createElement('tr');\n\n              const posTd = document.createElement('td');\n              posTd.textContent = l.ordre;\n              posTd.classList.add('ranking-pos');\n              tr.appendChild(posTd);\n\n              const nom = mapJugadors[l.jugador_id] || l.jugador_id;\n              const nameBtn = document.createElement('button');\n              nameBtn.textContent = nom;\n              nameBtn.addEventListener('click', () =>\n                mostraEvolucioJugador(l.jugador_id, nom)\n              );\n              const nomTd = document.createElement('td');\n              nomTd.classList.add('ranking-name');\n              nomTd.appendChild(nameBtn);\n              tr.appendChild(nomTd);\n\n              const potTd = document.createElement('td');\n              const potSpan = document.createElement('span');\n              const pot = idx === 0;\n              potSpan.textContent = pot ? '🟢' : '🔴';\n              potSpan.title = pot\n                ? 'Pot reptar el jugador 20'\n                : 'No pot reptar';\n              potTd.dataset.label = 'Pot reptar';\n              potTd.appendChild(potSpan);\n              tr.appendChild(potTd);\n\n              tbody.appendChild(tr);\n            });\n            table.appendChild(tbody);\n\n            const legenda = document.createElement('div');\n            ['🟢 Pot reptar', '🔴 No pot reptar'].forEach(t => {\n              const p = document.createElement('p');\n              p.textContent = t;\n              legenda.appendChild(p);\n            });\n            cont.appendChild(legenda);\n            appendResponsiveTable(cont, table);\n          } else {\n            const p = document.createElement('p');\n            p.textContent = \"No hi ha jugadors en llista d'espera.\";\n            cont.appendChild(p);\n          }\n        })\n      );\n\n      const btnAcces = document.createElement('button');\n      btnAcces.textContent = 'Reptes accés';\n      btnAcces.addEventListener('click', () =>\n        showSection(btnAcces, () =>\n          renderReptes('Reptes accés', r => r.tipus === 'acces')\n        )\n      );\n\n      const btnPartides = document.createElement('button');\n      btnPartides.textContent = 'Partides';\n      btnPartides.addEventListener('click', () =>\n        showSection(btnPartides, () => {\n          const title = document.createElement('h3');\n          title.textContent = 'Partides';\n          cont.appendChild(title);\n          if (Array.isArray(partides) && partides.length) {\n            const rankingMap = Object.fromEntries(\n              ranking.map(r => [r.jugador_id, parseInt(r.posicio, 10)])\n            );\n            const sorted = partides\n              .slice()\n              .sort((a, b) => new Date(b.data) - new Date(a.data));\n            sorted.forEach(p => {\n              const card = document.createElement('div');\n              card.classList.add('partida-card');\n              const repte = reptes.find(r => r.id === p.repte_id) || {};\n              const local = mapJugadors[p.local_id] || p.local_id;\n              const visitant = mapJugadors[p.visitant_id] || p.visitant_id;\n              let resultat = '';\n              if (p.caramboles_local && p.caramboles_visitant) {\n                resultat = `${p.caramboles_local}-${p.caramboles_visitant}`;\n              } else if (\n                repte.resultat_motiu &&\n                repte.resultat_motiu !== 'RESULTAT'\n              ) {\n                resultat = repte.resultat_motiu\n                  .toLowerCase()\n                  .replace(/_/g, ' ');\n                resultat = resultat.charAt(0).toUpperCase() + resultat.slice(1);\n              }\n              const posLocalAfter = rankingMap[p.local_id];\n              const posVisitantAfter = rankingMap[p.visitant_id];\n              const swap = repte.resultat_guanya_reptador === 'TRUE';\n              let posLocalInicial = posLocalAfter;\n              let posVisitantInicial = posVisitantAfter;\n              if (swap && posLocalAfter !== undefined && posVisitantAfter !== undefined) {\n                posLocalInicial = posVisitantAfter;\n                posVisitantInicial = posLocalAfter;\n              }\n              const posLocalText =\n                posLocalInicial !== undefined ? posLocalInicial : '-';\n              const posVisitantText =\n                posVisitantInicial !== undefined ? posVisitantInicial : '-';\n              const swapText = swap\n                ? 'Intercanvi de posicions'\n                : 'No intercanvi de posicions';\n              const date = p.data\n                ? new Date(p.data).toLocaleDateString('ca-ES')\n                : '';\n              card.innerHTML = `\n                <h4>${date}</h4>\n                <p>${local} (Pos. ${posLocalText}) vs ${visitant} (Pos. ${posVisitantText})</p>\n                <p>Resultat: ${resultat}</p>\n                <p>${swapText}</p>\n              `;\n              cont.appendChild(card);\n            });\n          } else {\n            const p = document.createElement('p');\n            p.textContent = 'No hi ha partides registrades.';\n            cont.appendChild(p);\n          }\n        })\n      );\n      const btnGestio = document.createElement('button');\n      btnGestio.id = 'btn-gestio-reptes';\n      btnGestio.textContent = 'Gestió reptes';\n      btnGestio.addEventListener('click', () =>\n        showSection(btnGestio, async () => {\n          const mod =\n            window.gestioReptes || (await import('./gestioReptes.js'));\n          window.gestioReptes = mod;\n          mod.mostraGestioReptes(cont);\n        })\n      );\n      if (!state.isAdmin) {\n        btnGestio.style.display = 'none';\n      }\n\n      const btnNormativa = document.createElement('button');\n      btnNormativa.textContent = 'Normativa';\n      btnNormativa.addEventListener('click', () =>\n        showSection(btnNormativa, () => {\n\n          cont.innerHTML = `\n<div class=\"normes-container\">\n  <h2 class=\"normes-title\">Normativa Continu 3B</h2>\n\n  <div class=\"normes-card\">\n    <h3>📊 Rànquing actiu</h3>\n    <ul>\n      <li><strong>Màxim 20 jugadors</strong>, actualitzat contínuament mitjançant reptes directes</li>\n      <li>Els jugadors que vulguin formar part del rànquing un cop s'arribi al màxim de 20 jugadors formaran part de la <strong>llista d'espera</strong>.</li>\n    </ul>\n  </div>\n\n  <div class=\"normes-card\">\n    <h3>⚔️ Reptes normals</h3>\n    <ul>\n      <li>Pots reptar fins a <strong>2 posicions</strong> per sobre teu.</li>\n      <li><strong>Màxim un repte actiu</strong> per jugador.</li>\n      <li><strong>Mínim 7 dies</strong> entre reptes.</li>\n      <li>Si guanya el reptador → <strong>intercanvi de posicions</strong>.</li>\n      <li>Si perd el reptador → <strong>no hi ha canvis</strong>.</li>\n    </ul>\n  </div>\n\n  <div class=\"normes-card\">\n    <h3>🚪 Reptes d’accés</h3>\n    <ul>\n      <li><strong>Primer de la llista d’espera</strong> pot reptar el jugador 20.</li>\n      <li>Si guanya → <strong>entra al rànquing</strong> (pos. 20) i el perdedor passa a la llista d’espera.</li>\n      <li>Si perd → passa al final de la <strong>llista d’espera</strong>.</li>\n    </ul>\n  </div>\n\n  <div class=\"normes-card\">\n    <h3>⏱️ Terminis</h3>\n    <p><strong>7 dies</strong> per acceptar un repte i <strong>7 dies</strong> per jugar-lo un cop acceptat.</p>\n  </div>\n\n  <div class=\"normes-card\">\n    <h3>⚠️ Penalitzacions</h3>\n    <ul>\n      <li>Incompareixença o refús sense motiu → <strong>derrota automàtica</strong>.</li>\n      <li>Sense acord de data → tots dos <strong>perden una posició</strong>.</li>\n    </ul>\n  </div>\n\n  <div class=\"normes-card\">\n    <h3>😴 Inactivitat</h3>\n    <ul>\n      <li><strong>3 setmanes</strong> sense reptes → baixa 5 posicions (pre-inactiu).</li>\n      <li><strong>6 setmanes</strong> sense reptes → surt del rànquing i entra el primer de la llista d’espera.</li>\n    </ul>\n  </div>\n\n  <div class=\"normes-card\">\n    <p>Consulta la <a href=\"https://docs.google.com/document/d/165_bh9m0WxRU_LoTt_k8aiJseZZn9bBZ/edit?usp=sharing&amp;ouid=102336298592739127647&amp;rtpof=true&amp;sd=true\" target=\"_blank\" rel=\"noopener\"><strong>normativa completa</strong></a>.</p>\n  </div>\n</div>`;\n        })\n      );\n\n      [\n        btnRanking,\n        btnReptes,\n        btnLlista,\n        btnAcces,\n        btnPartides,\n        btnNormativa,\n        btnGestio\n      ].forEach(b => btnContainer.appendChild(b));\n\n      btnRanking.click();\n    })\n    .catch(err => {\n      console.error('Error carregant dades continu 3B', err);\n      cont.innerHTML = '<p>Error carregant dades.</p>';\n    });\n}\n","let deferredPrompt;\n\nexport function setupInstallPrompt() {\n  const installBtn = document.getElementById('btn-install');\n  if (!installBtn) return;\n\n  installBtn.style.display = 'none';\n\n  window.addEventListener('beforeinstallprompt', (e) => {\n    e.preventDefault();\n    deferredPrompt = e;\n    installBtn.style.display = 'inline-block';\n  });\n\n  installBtn.addEventListener('click', async () => {\n    if (!deferredPrompt) return;\n    deferredPrompt.prompt();\n    await deferredPrompt.userChoice;\n    deferredPrompt = null;\n    installBtn.style.display = 'none';\n  });\n\n  window.addEventListener('appinstalled', () => {\n    deferredPrompt = null;\n    installBtn.style.display = 'none';\n  });\n}\n","export function setupServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', () => {\n      navigator.serviceWorker.register('./service-worker.js')\n        .then(reg => {\n          console.log('SW registrat!', reg);\n          const checkForUpdate = () => {\n            reg.update().then(() => {\n              if (reg.waiting) {\n                reg.waiting.postMessage({ type: 'SKIP_WAITING' });\n              }\n            });\n          };\n\n          checkForUpdate();\n          setInterval(checkForUpdate, 24 * 60 * 60 * 1000);\n        })\n        .catch(err => console.error('Error al registrar el SW:', err));\n\n      let refreshing = false;\n      navigator.serviceWorker.addEventListener('controllerchange', () => {\n        if (refreshing) return;\n        window.location.reload();\n        refreshing = true;\n      });\n    });\n  }\n}\n","import { setupServiceWorker } from './js/sw-register.js';\nimport { inicialitza } from './js/init.js';\nimport { setupRouter } from './js/router.js';\nimport { closeChart, handleResize } from './js/graficos.js';\nimport { setupInstallPrompt } from './js/install.js';\n\nsetupServiceWorker();\nsetupInstallPrompt();\nsetupRouter();\n\ndocument.getElementById('close-chart').addEventListener('click', closeChart);\nwindow.addEventListener('resize', handleResize);\n\ninicialitza();\n","import { state } from './state.js';\n\n// Inicialitza recursos necessaris per a la gestió de reptes\nexport async function initGestioReptesAdmin() {\n  console.log('Mòdul de gestió de reptes carregat');\n}\n\n// Mostra el panell de gestió de reptes dins del contenidor rebut\nexport async function mostraGestioReptes(container) {\n  container.innerHTML = '';\n  const title = document.createElement('h3');\n  title.textContent = 'Gestió de reptes';\n  container.appendChild(title);\n\n  try {\n    const res = await fetch('/api/challenges');\n    const data = await res.json();\n    const pre = document.createElement('pre');\n    pre.textContent = JSON.stringify(data, null, 2);\n    container.appendChild(pre);\n  } catch (err) {\n    const p = document.createElement('p');\n    p.textContent = 'Error carregant reptes';\n    container.appendChild(p);\n  }\n}\n"],"names":["state","ranquing","anys","anySeleccionat","modalitatSeleccionada","lineChart","classificacions","classYears","classAnySeleccionat","classModalitatSeleccionada","classCategoriaSeleccionada","events","isAdmin","agendaSetmanaInici","d","Date","setHours","setDate","getDate","getDay","torneigCaramboles","torneigCategoriaSeleccionada","setLineChart","chart","appendResponsiveTable","container","table","wrapper","document","createElement","className","appendChild","adjustChartSize","chartContainer","getElementById","style","width","height","canvas","resize","lastFocusedElement","mostraEvolucioJugador","jugador","nom","modalitats","dadesPerMod","map","mod","filter","r","Jugador","Modalitat","any","parseInt","Any","mitjana","parseFloat","Mitjana","sort","a","b","Set","flat","colors","datasets","idx","label","data","y","reg","find","Number","borderColor","backgroundColor","tension","fill","overlay","display","activeElement","closeBtn","focus","title","textContent","ctx","getContext","destroy","Chart","type","labels","options","plugins","legend","position","scales","x","text","ticks","stepSize","autoSkip","suggestedMin","all","flatMap","v","min","length","Math","floor","suggestedMax","max","ceil","beginAtZero","responsive","maintainAspectRatio","mostraRanquing","cont","innerHTML","taula","cap","forEach","t","th","tr","clau","td","valor","toFixed","NomComplet","classList","add","addEventListener","e","stopPropagation","mostraClassificacio","Categoria","num","isNaN","ADMIN_CODE","window","adminAttempts","originalFetch","fetch","bind","async","url","opts","startsWith","code","localStorage","getItem","promptAdminCode","headers","res","status","alert","removeItem","adminBtn","preparaTorneigCategories","categories","render","includes","cat","btn","querySelectorAll","remove","modal","input","submit","Promise","resolve","value","submitHandler","trim","removeEventListener","keyHandler","test","setItem","manageBtn","gestioReptes","then","initGestioReptesAdmin","enableAdminFeatures","key","mostraTorneig","dades","file","catCont","partides","Array","isArray","programades","p","Data","pendents","dataDiff","localeCompare","horaDiff","Hora","Billar","match","filters","id","placeholder","dataContainer","mesos","filtre","toLowerCase","progFiltrades","j1","j2","dayCounts","reduce","acc","lastData","tdDia","yyyy","mm","dd","split","diaNum","diaTxt","count","rowSpan","billar","replace","hora","val","pendFiltrades","Jornada","h3","taulaPend","capPend","mostraCalendari","dateA","Timestamp","list","nom1","nom2","car1","car2","entrades","mitj1","mitj2","emoji1","emoji2","colgroup","cl","col","thead","headerRow","tbody","tr1","tr2","tdNom1","tdCar1","tdEntr","tdMitj1","tdNom2","tdCar2","tdMitj2","mostraPartides","catField","nomField","agrupats","push","Object","keys","car","ul","li","puntsA","puntsB","mitjanaA","h","slice","row","_","obj","pre","JSON","stringify","uiSections","hideAll","el","routes","show","action","calContainer","nav","prev","next","calTable","headRow","calBody","listTable","today","selectedDate","UTC","getFullYear","getMonth","toISOString","end","weekEnd","startStr","toLocaleDateString","day","month","endStr","year","i","cell","date","iso","dataset","dayEvents","ev","cls","some","renderCalendar","header","m","tipus","Tipus","renderList","json","tipusMap","item","entries","items","tipusDetails","tipusSummary","ci","URL","Url","querySelector","href","target","rel","Titol","Nom","Name","Text","catch","err","console","error","btnContainer","ranking","llista","reptes","jugadors","mapJugadors","fromEntries","j","showSection","filterLabel","chkDisponibles","createTextNode","btnRanking","click","posicio","info","jugador_id","potReptar","pot_reptar","potSerReptat","pot_ser_reptat","motiuRaw","eligibility_reptar_motiu","motiuText","terminiText","ACCEPTED","dies","pot","checked","posTd","nameBtn","partJug","local_id","visitant_id","esLocal","rivalId","caramboles_local","caramboles_visitant","backBtn","mostraPartidesJugador","nomTd","reptarTd","reptarSpan","serTd","serSpan","motiuTd","terminiTd","legenda","renderReptes","titleText","filterFn","reptesFiltrats","reptesPendents","estat","reptesAcceptats","reptesProgramats","reptesTancats","drawCards","infoFn","card","reptador","reptador_id","reptat","reptat_id","h4","section","emptyMsg","st","calcLimit","base","getTime","mapPartides","motiusMap","REFUS","INCOMPAREIXENCA","RESULTAT","infoTancats","partida","partida_id","motiu","resultat_motiu","created_at","data_acceptacio","data_programa","limitAcceptar","limitJugar","detTancats","sumTancats","btnReptes","btnLlista","ordre","l","potTd","potSpan","btnAcces","btnPartides","rankingMap","repte","repte_id","local","visitant","resultat","charAt","toUpperCase","posLocalAfter","posVisitantAfter","swap","resultat_guanya_reptador","posLocalInicial","posVisitantInicial","undefined","posLocalText","posVisitantText","swapText","btnGestio","mostraGestioReptes","btnNormativa","join","deferredPrompt","navigator","serviceWorker","register","log","checkForUpdate","update","waiting","postMessage","setInterval","refreshing","location","reload","installBtn","preventDefault","prompt","userChoice","setupInstallPrompt","contains","isVisible","sm","route","handleRoute","tagName","dadesRanking","dadesClass","dadesEvents","dadesCalendari","dadesFestius","values","titol","concat","f","select","opt","selected","preparaSelectors","yearSel","modalBtns","catBtns","c","preparaSelectorsClassificacio"],"mappings":"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"}